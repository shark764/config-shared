"use strict";!function(e){e.module("liveopsConfigPanel.shared.config",[]).value("liveopsConfigPanel.shared.config",{debug:!0}),e.module("liveopsConfigPanel.shared.directives",[]),e.module("liveopsConfigPanel.shared.filters",[]),e.module("liveopsConfigPanel.shared.services",["toastr","ngLodash","ngResource","pascalprecht.translate"]),e.module("liveopsConfigPanel.shared",["liveopsConfigPanel.shared.config","liveopsConfigPanel.shared.directives","liveopsConfigPanel.shared.filters","liveopsConfigPanel.shared.services"])}(angular),angular.module("liveopsConfigPanel.config",[]).constant("jsedn",window.jsedn).constant("preferenceKey","LIVEOPS-PREFERENCE-KEY").constant("sessionKey","LIVEOPS-SESSION-KEY").constant("uuidcacheKey","LIVEOPS-CACHE-KEY").factory("userStatuses",function(){return function(){return[{display:"Disabled",value:"disabled"},{display:"Enabled",value:"enabled"},{display:"Pending",value:"pending"}]}}).factory("statuses",function(){return function(){return[{display:"Disabled",value:!1},{display:"Enabled",value:!0}]}}).factory("ynStatuses",function(){return function(){return[{display:"No",value:!1},{display:"Yes",value:!0}]}}).factory("tenantStatuses",function(){return function(){return[{display:"Disabled",value:"disabled"},{display:"Expired Invitation",value:"expired"},{display:"Pending Invitation",value:"pending"},{display:"Accepted",value:"accepted"},{display:"Pending Acceptance",value:"invited"},{display:"Removed",value:"removed"}]}}).constant("userStates",[{display:"Busy",value:"busy"},{display:"Ready",value:"ready"},{display:"Not Ready",value:"not-ready"},{display:"Allocated",value:"allocated"},{display:"Offline",value:"offline"}]).constant("userRoles",[{value:"admin",display:"Admin"},{value:"user",display:"User"},{value:"other",display:"Other"}]),angular.module("liveopsConfigPanel.shared.filters").filter("hasPermission",["UserPermissions",function(e){return function(r){return angular.isArray(r)||(r=[r]),e.hasPermissionInList(r)}}]),angular.module("liveopsConfigPanel.shared.services").service("Alert",["toastr","$window",function(e,r){this.confirm=function(e,n,t){r.confirm(e)?n&&n():t&&t()},this.warning=function(){e.warning.apply(this,arguments)},this.success=function(){e.success.apply(this,arguments)},this.error=function(){e.error.apply(this,arguments)},this.info=function(){e.info.apply(this,arguments)}}]),angular.module("liveopsConfigPanel.shared.services").service("DirtyForms",["Alert","$translate",function(e,r){var n=this;this.forms=[],this.hasDirty=function(){var e=!1;return angular.forEach(n.forms,function(r){r.$dirty&&(e=!0)}),e},this.registerForm=function(e){n.forms.push(e)},this.removeForm=function(e){n.forms.removeItem(e)},this.confirmIfDirty=function(t){n.hasDirty()?e.confirm(r.instant("unsavedchanges.nav.warning"),t,angular.noop):t()}}]),function(){var e=function(e,r,n){return{seed:function(t,o){var a,s,i,u,l,c,f,p,d,h="10f15d80-0052-11e5-b68b-fb65b1fe22e1";return e.get("http://localhost:9080/v1/regions").then(function(r){return a=r.data.result[0].id,console.log("-- TITAN_REGION_ID --",a),e.post("http://localhost:9080/v1/login",{email:"titan@liveops.com",password:"gKVnfF9wrs6XPSYs"})}).then(function(r){return s=r.data.result.user.id,console.log("-- TITAN_ADMIN_ID --",s),e.post("http://localhost:9080/v1/users",{createdBy:s,email:t,password:o,firstName:"Test",lastName:"User",status:"enabled",externalId:"00000000-0000-0000-000000000000"})}).then(function(r){return i=r.data.result.id,u=r.data.result.email,console.log("-- CREATED_USER_ID --",i),console.log("-- CREATED_USER_EMAIL --",u),e.post("http://localhost:9080/v1/tenants",{adminUserId:i,createdBy:s,description:"This is a test tenant created by the seed service.",name:"Test Tenant",regionId:a})}).then(function(r){return l=r.data.result.id,console.log("-- CREATED TENANT ID --",l),e.post("http://localhost:9080/v1/tenants/"+l+"/invites",{roleId:h,email:u})}).then(function(a){return c=a.data.result.invitation.invitationToken,console.log("-- CREATED_INVITE_TOKEN --",c),console.log("-- LOG IN AS NEW USER --"),n(function(){r.login(t,o).then(function(){return e.get("http://localhost:9080/v1/tenants/"+l+"/invites/"+i+"/accept?token="+c)}).then(function(r){return d=r.data.result,console.log("-- ACCEPTED_INVITE_STATUS --",d),e.post("http://localhost:9080/v1/tenants/"+l+"/flows",{createdBy:i,description:"Test flow description.",name:"Test flow",tenantId:l,type:"customer"})}).then(function(r){return f=r.data.result.id,console.log("-- CREATED_FLOW_ID --",f),e.post("http://localhost:9080/v1/tenants/"+l+"/flows/"+f+"/versions",{createdBy:i,description:"Initial Version.",name:"v1",flowId:f,tenantId:l,flow:"[]"})}).then(function(e){p=e.data.result.version,console.log("-- CREATED VERSION ID --",p),console.log('\n\n Done seeding DB with all necessary data to access the flows screen. Log in as the user "'+t+'" with the password "'+o+'" and access the flows screen and go to town :)')})},5e3),r.login(t,o)})}}};angular.module("liveopsConfigPanel.shared.services").service("flowSetup",e)}(),Array.prototype.removeItem=function(e){var r=this.indexOf(e);r>-1&&this.splice(r,1)},Array.prototype.clear=function(){this.splice(0,this.length)},Array.prototype.shuffle=function(){var e,r,n=this.length;if(0===n)return this;for(;--n;)e=Math.floor(Math.random()*(n+1)),r=this[n],this[n]=this[e],this[e]=r;return this},String.prototype.insert=function(e,r){return e>0?this.substring(0,e)+r+this.substring(e,this.length):r+this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.contains||(String.prototype.contains=function(e){return this.indexOf(e)>-1}),angular.module("liveopsConfigPanel.shared.filters").filter("hasPermission",["UserPermissions",function(e){return function(r){return angular.isArray(r)||(r=[r]),e.hasPermissionInList(r)}}]),angular.module("liveopsConfigPanel.shared.filters").filter("keysCount",[function(){return function(e){return Object.keys(e).length}}]),angular.module("liveopsConfigPanel.shared.filters").filter("matchesField",["$filter",function(e){return function(r,n,t){var o=function(r,n,t){if(!(angular.isUndefined(r)||angular.isUndefined(n)||""===n||angular.isUndefined(t))){var a=n.indexOf(":");if(a>-1){var s=n.substring(0,a),i=n.substring(a+1);return o(r[s],i,t)?r:void 0}if(angular.isArray(r)){for(var u=0;u<r.length;u++)if(r[u][n]===t)return r}else if(e("parse")(r,n)===t)return r}};return o(r,n,t)}}]),angular.module("liveopsConfigPanel.shared.filters").filter("objectNegation",function(){return function(e,r,n,t){var o=[];return angular.forEach(e,function(e){for(var a=!0,s=0;s<n.length;s++){var i=n[s];if(e[r]===i[t]){a=!1;break}}a&&o.push(e)}),o}}),angular.module("liveopsConfigPanel.shared.filters").filter("invoke",[function(){return function(e,r){return angular.isFunction(e)?e.call(r):e}}]),angular.module("liveopsConfigPanel.shared.filters").filter("parse",["$parse",function(e){return function(r,n){return e(n)(r)}}]),angular.module("liveopsConfigPanel.shared.filters").filter("search",["$parse",function(e){return function(r,n,t){function o(e){return e.replace(/([.+?^=!:${}()|\[\]\/\\])/g,"\\$1"),e.replace(/([*])/g,".*")}if(!n||!t)return r;var a=function(r,n){var t=[],o=e(r.path),s=o(n);return"string"==typeof s?t=[s]:"object"==typeof s&&angular.forEach(o(n),function(e){t="inner"in r?t.concat(a(r.inner,e)):[e]}),t},s=[];return angular.forEach(r,function(r){var i=new RegExp(o(t),"i"),u="";angular.forEach(n,function(n){"string"==typeof n?u+=e(n)(r)+" ":"object"==typeof n&&(u+=a(n,r).join(" ")+" ")}),i.test(u)&&s.push(r)}),s}}]),angular.module("liveopsConfigPanel.shared.filters").filter("selectedOptions",["$filter",function(e){return function(r,n){var t=[],o=e("invoke")(n.options);return angular.forEach(r,function(r){var a=!1;angular.forEach(o,function(o){var s=e("invoke")(o.value,o);!a&&o.checked&&e("matchesField")(r,n.name,s)&&(t.push(r),a=!0)})}),t}}]),angular.module("liveopsConfigPanel.shared.filters").filter("selectedTableOptions",["$parse","$filter",function(e,r){return function(n,t){var o=[];if(angular.isUndefined(n))return o;for(var a=!0,s=0;s<n.length;s++){for(var i=n[s],u=!0,l=0;l<t.length;l++){var c=!0,f=t[l];if(e("header.options")(f)){for(var p=f.lookup?f.lookup:f.name,d=r("invoke")(f.header.options),h=0;h<d.length;h++){var g=d[h];if(a=a&&!g.checked,g.checked){var v=e(f.header.valuePath?f.header.valuePath:"value"),y=r("invoke")(v(g),g);if(r("matchesField")(i,p,y)){c=!0;break}c=!1}}u=u&&c}}u&&o.push(i)}return a?n:o}}]),angular.module("liveopsConfigPanel.shared.services").service("Alert",["toastr","$window",function(e,r){this.confirm=function(e,n,t){r.confirm(e)?n&&n():t&&t()},this.warning=function(){e.warning.apply(this,arguments)},this.success=function(){e.success.apply(this,arguments)},this.error=function(){e.error.apply(this,arguments)},this.info=function(){e.info.apply(this,arguments)}}]),angular.module("liveopsConfigPanel.shared.services").service("cacheAddInterceptor",["queryCache",function(e){this.response=function(r){var n=Object.getPrototypeOf(r.resource),t=r.resource.cacheKey?r.resource.cacheKey():n.resourceName;return e.get(t)||e.put(t,[]),e.get(t).push(r.resource),r.resource}}]),angular.module("liveopsConfigPanel.shared.services").service("cacheRemoveInterceptor",["queryCache",function(e){this.response=function(r){var n=Object.getPrototypeOf(r.resource),t=r.resource.cacheKey?r.resource.cacheKey():n.resourceName;return e.get(t)&&e.get(t).removeItem(r.resource),r.resource}}]),angular.module("liveopsConfigPanel.shared.services").factory("LiveopsResourceFactory",["$http","$resource","$q","queryCache","lodash",function(e,r,n,t,o){function a(e){return e.result?e.result:e}function s(e,r){return o.startsWith(e,"$")?void 0:r}function i(e){if(angular.isArray(e)){var r=function(r){return angular.forEach(e,function(e){e.response(r)}),r.resource},n={response:r};return n}return e}function u(e,r){return o.startsWith(e,"$")?void 0:r}return{create:function(n){function l(e){var r=angular.copy(e);return angular.forEach(r,function(e,t){var a=o.findIndex(n.updateFields,{name:t});(0>a||null===e&&n.updateFields[a].optional)&&delete r[t]}),r}function c(e){var r=l(e);return JSON.stringify(r,u)}function f(e){return JSON.stringify(e,s)}n.requestUrlFields=angular.isDefined(n.requestUrlFields)?n.requestUrlFields:{id:"@id",tenantId:"@tenantId",groupId:"@groupId",flowId:"@flowId",queueId:"@queueId",userId:"@userId",memberId:"@memberId"};var p=Array.prototype.concat(e.defaults.transformResponse,a),d=n.getRequestTransformer,h=n.getResponseTransformer?Array.prototype.concat(n.getResponseTransformer,p):p,g=n.queryRequestTransformer,v=n.queryResponseTransformer?Array.prototype.concat(n.queryResponseTransformer,p):p,y=n.putRequestTransformer?Array.prototype.concat(n.putRequestTransformer,c):c,m=n.putResponseTransformer?Array.prototype.concat(n.putRequestTransformer,p):p,$=n.postRequestTransformer?Array.prototype.concat(n.postRequestTransformer,f):f,E=n.postResponseTransformer?Array.prototype.concat(n.postResponseTransformer,p):p,I=n.deleteRequestTransformer,C=n.deleteResponseTransformer?Array.prototype.concat(n.deleteResponseTransformer,p):p,P={"Content-Type":"application/json"},R=r(n.endpoint,n.requestUrlFields,{query:{method:"GET",isArray:!0,headers:P,transformRequest:g,transformResponse:v,interceptor:i(n.queryInterceptor)},get:{method:"GET",headers:P,transformRequest:d,transformResponse:h,interceptor:i(n.getInterceptor)},update:{method:"PUT",headers:P,transformRequest:y,transformResponse:m,interceptor:i(n.updateInterceptor)},save:{method:"POST",headers:P,transformRequest:$,transformResponse:E,interceptor:i(n.saveInterceptor)},"delete":{method:"DELETE",headers:P,transformRequest:I,transformResponse:C,interceptor:i(n.saveInterceptor)}});R.prototype.resourceName=n.resourceName,R.prototype.$$backupSudoProperties=function(){var e={};return angular.forEach(this,function(r,n){n.match(/^\$[^$].*/g)&&!angular.isFunction(r)&&["$original","$busy","$resolved"].indexOf(n)<0&&(e[n]=r)}),e},R.prototype.$$restoreSudoProperties=function(e,r){angular.forEach(r,function(r,n){e[n]?angular.isObject(r)&&angular.extend(e[n],r):e[n]=r})};var T=R.get;R.get=function(e,r,n){var t=T.call(this,e,r,n);return t.$promise.then(function(e){return e.$original=angular.copy(e),e}),t};var b=R.query;R.query=function(e,r,n){var t=b.call(this,e,r,n);return t.$promise.then(function(e){return angular.forEach(e,function(e){e.$original=angular.copy(e)}),e}),t};var A=R.prototype.$save;R.prototype.$save=function(e,r,n){var t=A.call(this,e,r,n);return t.then(function(e){return e.$original=angular.copy(e),e}),t};var w=R.prototype.$update;return R.prototype.$update=function(e,r,n){var t=w.call(this,e,r,n);return t.then(function(e){return e.$original=angular.copy(e),e}),t},R.cachedGet=function(e,r,n){var a=r?r:this.prototype.resourceName,s=t.get(a);(!s||n)&&(t.put(a,[]),s=t.get(a));var i=o.find(s,e);if(!i){i=this.get(e);for(var u in e)i[u]=e[u];s.push(i)}return i},R.cachedQuery=function(e,r,n){var o=r?r:this.prototype.resourceName;if(!t.get(o)||n){var a=this.query(e);return t.put(o,a),a}return t.get(o)},R.prototype.save=function(e,r,n){var t=this,o=this.isNew()?this.$save:this.$update;t.$busy=!0;var a=this.$$backupSudoProperties();return o.call(t,e,r,n).then(function(e){return t.$original=angular.copy(e),t.$original&&t.$original.$original&&delete t.$original.$original,t.$$restoreSudoProperties(e,a),e})["finally"](function(){t.$busy=!1})},R.prototype.reset=function(){for(var e in this.$original)e.match(/^\$.*/g)||angular.isFunction(this.$original[e])||(this[e]=angular.copy(this.$original[e]))},R.prototype.getDisplay=function(){return this.toString()},R.prototype.isNew=function(){return!(this.hasOwnProperty("created")||angular.isDefined(this.id))},R.prototype.$busy=!1,R}}}]),angular.module("liveopsConfigPanel.shared.services").factory("queryCache",["$cacheFactory",function(e){return e("queryCache")}]),angular.module("liveopsConfigPanel.shared.services").service("Modal",["$document","$rootScope","$compile","$q",function(e,r,n,t){var o=this;this.showConfirm=function(a){var s={title:"",message:"",okCallback:angular.noop,cancelCallback:angular.noop},i=t.defer(),u=angular.extend(s,a),l=r.$new();l.modalBody="app/shared/services/modal/confirmModal.html",l.title=u.title,l.message=u.message,l.okCallback=function(){o.close(),i.resolve("true"),u.okCallback()},l.cancelCallback=function(){o.close(),i.reject("false"),u.cancelCallback()};var c=n("<modal></modal>")(l);return e.find("body").append(c),i.promise},this.close=function(){e.find("modal").remove()}}]);