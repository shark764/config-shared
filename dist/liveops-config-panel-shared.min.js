!function(e){e.module("liveopsConfigPanel.shared.config",[]).value("liveopsConfigPanel.shared.config",{debug:!0}),e.module("liveopsConfigPanel.shared.directives",[]),e.module("liveopsConfigPanel.shared.filters",[]),e.module("liveopsConfigPanel.shared.services",[]),e.module("liveopsConfigPanel.shared",["liveopsConfigPanel.shared.config","liveopsConfigPanel.shared.directives","liveopsConfigPanel.shared.filters","liveopsConfigPanel.shared.services","ngResource"])}(angular),angular.module("liveopsConfigPanel").factory("AuthInterceptor",["$q","$injector","Session","apiHostname",function(e,t,n,o){var i=function(){this.request=function(e){return e.url.indexOf(o)>=0&&n.token&&(e.headers.Authorization=n.token&&n.token.indexOf("Token")>=0?n.token:"Basic "+n.token),e},this.responseError=function(t){return n.token&&n.token.indexOf("Token")>=0&&n.setToken(null),e.reject(t)}};return new i}]).config(function(e){e.interceptors.push("AuthInterceptor")}),describe("AuthInterceptor",function(){var e,t,n,o,i,r;beforeEach(module("liveopsConfigPanel",function(e){t=e})),beforeEach(inject(["$rootScope","$httpBackend","AuthInterceptor","Session","apiHostname",function(t,a,l,s,c){r=c,e=t.$new(),n=a,o=l,i=s}])),it("should be registered as an interceptor",function(){expect(t.interceptors).toContain("AuthInterceptor")}),it("should add the authorization header when the request URL and token are set and correct",function(){i.token="abc123";var e=o.request({url:r+"/v1/users",headers:{}});expect(e.headers.Authorization).toBe("Basic "+i.token)}),it("should not add the authorization header when the request URL is not valid",function(){i.token="abc123";var e=o.request({url:"http://google.com",headers:{}});expect(e.headers.Authorization).not.toBeDefined()}),it("should not add the authorization header when the token is not valid",function(){i.token="";var e=o.request({url:r+"/v1/users",headers:{}});expect(e.headers.Authorization).not.toBeDefined()})}),angular.module("liveopsConfigPanel").service("AuthService",["$resource","$http","$q","Session","apiHostname","User","$state",function(e,t,n,o,i,r,a){var l=this;this.login=function(e,t){o.token=null;var i=this.generateToken(e,t),a=this.fetchUserInfo(i);return a.then(function(e){var t=new r({id:e.data.result.userId,email:e.data.result.username,firstName:e.data.result.firstName,lastName:e.data.result.lastName}),n=e.data.result.tenants,a=e.data.result.platformPermissions;return o.set(t,n,i,a),e},function(e){return n.reject(e)})},this.refreshTenants=function(){return l.fetchUserInfo(o.token).then(function(e){o.setTenants(e.data.result.tenants)})},this.logout=function(){o.destroy(),a.transitionTo("login")},this.fetchUserInfo=function(e){return t.post(i+"/v1/login",{},{headers:{Authorization:"Basic "+e}})},this.generateToken=function(e,t){return window.btoa(e+":"+t)}}]);var TOKEN="dGl0YW5AbGl2ZW9wcy5jb206Z0tWbmZGOXdyczZYUFNZcw==",USERNAME="titan@liveops.com",PASSWORD="gKVnfF9wrs6XPSYs",TENANTS=[{tenantId:1,name:"test1",tenantPermissions:[]},{tenantId:2,name:"test2",tenantPermissions:[]}],platformPermissions=[],LOGIN_RESPONSE;describe("AuthService",function(){var e,t,n,o,i,r;beforeEach(module("liveopsConfigPanel")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.mock.content.management.users")),beforeEach(inject(["$rootScope","$location","$httpBackend","AuthService","Session","apiHostname","mockUsers",function(a,l,s,c,u,d,f){e=a.$new(),t=l,n=s,o=c,i=u,r=d,LOGIN_RESPONSE={result:{userId:f[0].id,username:f[0].email,tenants:TENANTS,platformPermissions:platformPermissions}}}])),it("should have a method get an authentication token",function(){var e=o.generateToken(USERNAME,PASSWORD);expect(e).toBe(TOKEN)}),it("should have a method to logout which destroys the session",function(){o.logout(),expect(i.token).toBeNull()}),describe("ON login",function(){it("should set the session when successful",function(){n.expectPOST(r+"/v1/login").respond(LOGIN_RESPONSE),spyOn(i,"set"),o.login(USERNAME,PASSWORD),n.flush(),expect(i.set).toHaveBeenCalledWith(jasmine.any(Object),TENANTS,o.generateToken(USERNAME,PASSWORD),platformPermissions)}),it("should validate on failure",function(){n.expectPOST(r+"/v1/login").respond(500,""),spyOn(i,"set"),o.login(USERNAME,PASSWORD),n.flush(),expect(i.set).not.toHaveBeenCalled(),expect(i.token).toBeNull()})}),describe("refreshTenants function",function(){it("should set the tenants",inject([function(){n.expectPOST(r+"/v1/login").respond(LOGIN_RESPONSE),spyOn(i,"setTenants"),o.refreshTenants(),n.flush(),expect(i.setTenants).toHaveBeenCalledWith(TENANTS)}]))})}),angular.module("liveopsConfigPanel").run(["$rootScope","$state","Session",function(e,t,n){e.$on("$stateChangeStart",function(e,o){o.isPublic||n.isAuthenticated()||(e.preventDefault(),t.go("login"))})}]);var TOKEN="dGl0YW5AbGl2ZW9wcy5jb206Z0tWbmZGOXdyczZYUFNZcw==";describe("routeSecurity",function(){var e,t,n,o,i;beforeEach(module("liveopsConfigPanel")),beforeEach(module("gulpAngular")),beforeEach(inject(["$rootScope","$state","$injector","AuthService","Session","$httpBackend","apiHostname",function(r,a,l,s,c,u,d){e=r.$new(),t=a,n=l,o=s,i=c,u.when("GET",d+"/v1/regions").respond({result:[{id:"c98f5fc0-f91a-11e4-a64e-7f6e9992be1f",description:"US East (N. Virginia)",name:"us-east-1"}]}),u.when("POST",d+"/v1/login").respond({result:{tenants:[]}})}])),describe("user is AUTHENTICATED",function(){beforeEach(function(){i.token=TOKEN}),it("should setup route interception and allow access to secure routes",inject(function(n){i.token="abc",t.go("content.management.users").then(function(){var e=n.$broadcast("$stateChangeStart",{});expect(e.defaultPrevented).toBeFalsy(),expect(t.current.name).toBe("content.management.users")}),e.$apply()}))}),describe("user is NOT AUTHENTICATED",function(){it("should setup route interception and prevent access to secure routes",inject(function(n){t.go("content.management.users"),i.token=null;var o=n.$broadcast("$stateChangeStart",{});e.$apply(),expect(o.defaultPrevented).toBeTruthy(),expect(t.current.name).toBe("login")})),it("should setup route interception and allow access to unsecure routes when not authenticated",inject(function(e){var t=e.$broadcast("$stateChangeStart",{isPublic:!0});expect(t.defaultPrevented).toBeFalsy()}))})}),angular.module("liveopsConfigPanel").service("Session",["$rootScope","sessionKey","preferenceKey","$translate","$filter",function(e,t,n,o,i){var r=this;this.userSessionKey=t,this.userPreferenceKey=n,this.token=null,this.user=null,this.lang=null,this.tenants=null,this.tenant=null,this.activeRegionId=null,this.columnPreferences={},this.platformPermissions=null,this.set=function(e,t,n,o){this.token=n,this.setUser(e),this.setTenants(t),this.setPlatformPermissions(o),this.flush()},this.setTenants=function(e){if(this.tenants=e&&e.length>0?e:[{tenantId:"",name:o.instant("session.tenants.none")}],this.tenant){var t=i("filter")(this.tenants,{tenantId:this.tenant.tenantId});this.tenant=t.length>0?t[0]:this.tenants[0]}else this.tenant=this.tenants[0];this.flush()},this.setUser=function(e){this.user={id:e.id,displayName:e.getDisplay(),email:e.email},this.flush()},this.setToken=function(e){this.token=e,this.flush()},this.setPlatformPermissions=function(e){this.platformPermissions=e,this.flush()},this.setColumnPreferences=function(e){this.columnPreferences=e,this.flush()},this.destroy=function(){this.token=null,this.user=null,this.tenants=null,this.platformPermissions=null,localStorage.removeItem(this.userSessionKey)},this.setTenant=function(e){r.tenant={tenantId:e.tenantId,tenantName:e.tenantName,tenantPermissions:e.tenantPermissions},r.flush()},this.destroyAll=function(){this.destroy(),this.activeRegionId=null,this.lang="en",this.tenant=null,localStorage.removeItem(this.userPreferenceKey)},this.restore=function(){angular.extend(this,JSON.parse(localStorage.getItem(this.userSessionKey))),angular.extend(this,JSON.parse(localStorage.getItem(this.userPreferenceKey)))},this.isAuthenticated=function(){return this.token?this.token.indexOf("Token")<0:!1},this.flush=function(){localStorage.setItem(r.userSessionKey,JSON.stringify({token:r.token,user:r.user,tenants:r.tenants,platformPermissions:r.platformPermissions})),localStorage.setItem(r.userPreferenceKey,JSON.stringify({lang:r.lang,activeRegionId:r.activeRegionId,tenant:r.tenant,columnPreferences:r.columnPreferences}))},this.restore()}]);var USER,TOKEN="dGl0YW5AbGl2ZW9wcy5jb206Z0tWbmZGOXdyczZYUFNZcw==";describe("Session",function(){var e,t;beforeEach(module("liveopsConfigPanel")),beforeEach(inject(["$rootScope","Session","User",function(n,o,i){e=n.$new(),t=o,USER=new i({role:"admin",email:"titan@liveops.com",createdBy:"00000000-0000-0000-0000-000000000000",displayName:"titan",updated:"2015-06-02T08:29:03Z",firstName:"titan",created:"2015-06-02T08:29:03Z",state:null,extension:null,externalId:null,updatedBy:"00000000-0000-0000-0000-000000000000",status:"enabled",id:"6d094710-0901-11e5-87f2-b1d420920055",lastName:"user"})}])),it("should have a method to set the session information",function(){t.set(USER,[],TOKEN),expect(t.token).toBe(TOKEN),expect(t.user.displayName).toBe(USER.getDisplay()),expect(t.isAuthenticated()).toBeTruthy(!0);var e=localStorage.getItem(t.userSessionKey);expect(e).toBeDefined()}),it("should have a method to destroy the session information",function(){t.set(USER,[],TOKEN),t.destroy(),expect(t.token).toBeNull(),expect(t.user).toBeNull(),expect(t.isAuthenticated()).toBeFalsy(),expect(localStorage.getItem(t.userSessionKey)).toBe(null)}),it("should have a method to restore the session information",function(){t.set(USER,[],TOKEN),t.token=null,t.user=null,expect(t.token).toBeNull(),expect(t.user).toBeNull(),expect(t.isAuthenticated()).toBeFalsy(),t.restore(),expect(t.token).toBe(TOKEN),expect(t.user.displayName).toBe(USER.getDisplay()),expect(t.isAuthenticated()).toBeTruthy()})}),angular.module("liveopsConfigPanel").service("UserPermissions",["Session","$state","$q","$timeout",function(e,t,n,o){var i=this;this.hasPermission=function(t){if(!e.isAuthenticated())return!1;var n=[];n.push.apply(n,e.platformPermissions),n.push.apply(n,e.tenant.tenantPermissions);for(var o=0;o<n.length;o++)if(n[o]===t)return!0;return!1},this.hasPermissionInList=function(e){for(var t=0;t<e.length;t++)if(this.hasPermission(e[t]))return!0;return!1},this.resolvePermissions=function(e){var r=n.defer();return o(function(){i.hasPermissionInList(e)?r.resolve():(t.go("content.userprofile",{messageKey:"permissions.unauthorized.message"}),r.reject())}),r.promise}}]),describe("UserPermissions Service",function(){var e,t;beforeEach(module("liveopsConfigPanel")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.mock.content")),beforeEach(inject(["UserPermissions","Session",function(n,o){e=n,t=o}])),describe("hasPermission function",function(){it("should exist",function(){expect(e.hasPermission).toBeDefined(),expect(e.hasPermission).toEqual(jasmine.any(Function))}),it("should return true if the given permission is in the Sessions platform permissions list",function(){t.platformPermissions=["permission1","permission2","permission3"],t.tenant.tenantPermissions=[];var n=e.hasPermission("permission2");expect(n).toBeTruthy()}),it("should return true if the given permission is in the selected tenants tenant permissions list",function(){t.platformPermissions=[],t.tenant.tenantPermissions=["permission1","permission2","permission3"];var n=e.hasPermission("permission2");expect(n).toBeTruthy()}),it("should return false if the given permission is not in either list",function(){t.platformPermissions=["permission5","permission6"],t.tenant.tenantPermissions=["permission1","permission2","permission3"];var n=e.hasPermission("SOME_OTHER_PERMISSION");expect(n).toBeFalsy()})}),describe("hasPermissionInList function",function(){it("should exist",function(){expect(e.hasPermissionInList).toBeDefined(),expect(e.hasPermissionInList).toEqual(jasmine.any(Function))}),it("should return true if one of the given permission is in the Sessions platform permissions list",function(){t.platformPermissions=["permission1","permission2","permission3"],t.tenant.tenantPermissions=[];var n=e.hasPermissionInList(["anotherPermission","permission2","somethinglese"]);expect(n).toBeTruthy()}),it("should return true if the given permission is in the selected tenants tenant permissions list",function(){t.platformPermissions=[],t.tenant.tenantPermissions=["permission1","permission2","permission3"];var n=e.hasPermissionInList(["anotherPermission","permission2","permission3"]);expect(n).toBeTruthy()}),it("should return false if none of the given permission is not in either list",function(){t.platformPermissions=["permission5","permission6"],t.tenant.tenantPermissions=["permission1","permission2","permission3"];var n=e.hasPermissionInList(["SOME_OTHER_PERMISSION","NOT_A_PERMISSION"]);expect(n).toBeFalsy()})}),describe("resolvePermissions function",function(){it("should exist",function(){expect(e.resolvePermissions).toBeDefined(),expect(e.resolvePermissions).toEqual(jasmine.any(Function))}),it("should resolve the returned promise if the user has at least one of the permissions given",inject(["$timeout",function(t){spyOn(e,"hasPermissionInList").and.returnValue(!0);var n=e.resolvePermissions(["A_PERMISSION"]);t.flush(),expect(n.$$state.status).toEqual(1)}])),it("should reject the returned promise if the user does not have at least one of the permissions given",inject(["$timeout",function(t){spyOn(e,"hasPermissionInList").and.returnValue(!1);var n=e.resolvePermissions(["A_PERMISSION"]);t.flush(),expect(n.$$state.status).toEqual(2)}]))})}),Array.prototype.removeItem=function(e){var t=this.indexOf(e);t>-1&&this.splice(t,1)},Array.prototype.clear=function(){this.splice(0,this.length)},Array.prototype.shuffle=function(){var e,t,n=this.length;if(0===n)return this;for(;--n;)e=Math.floor(Math.random()*(n+1)),t=this[n],this[n]=this[e],this[e]=t;return this},jsedn.Map.prototype.remove=function(e){this.keys.splice(e,1),this.vals.splice(e,1)},String.prototype.insert=function(e,t){return e>0?this.substring(0,e)+t+this.substring(e,this.length):t+this},String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.contains||(String.prototype.contains=function(e){return this.indexOf(e)>-1}),angular.module("liveopsConfigPanel.shared.services").factory("ErrorInterceptor",["$rootScope","$q","$injector","Alert","apiHostname","$translate",function(e,t,n,o,i,r){return{responseError:function(e){return(0===e.status||e.status>=500)&&e.config.url.indexOf(i)>-1&&o.error(r.instant("api.error")),t.reject(e)}}}]).config(function(e){e.interceptors.push("ErrorInterceptor")}),angular.module("liveopsConfigPanel.shared.services").service("DirtyForms",["Alert","$translate",function(e,t){var n=this;this.forms=[],this.hasDirty=function(){var e=!1;return angular.forEach(n.forms,function(t){t.$dirty&&(e=!0)}),e},this.registerForm=function(e){n.forms.push(e)},this.removeForm=function(e){n.forms.removeItem(e)},this.confirmIfDirty=function(o){n.hasDirty()?e.confirm(t.instant("unsavedchanges.nav.warning"),o,angular.noop):o()}}]),describe("DirtyForms service",function(){var e;beforeEach(module("liveopsConfigPanel.shared.services")),beforeEach(inject(["DirtyForms",function(t){e=t}])),it("registerForm function should add the item to the forms list",inject(function(){e.registerForm({name:"Thename"}),expect(e.forms.length).toBe(1),expect(e.forms[0].name).toEqual("Thename")})),it("removeForm function should add the item to the forms list",inject(function(){var t={name:"Thename"};e.forms.push(t),expect(e.forms.length).toBe(1),e.removeForm(t),expect(e.forms.length).toBe(0)})),describe("hasDirty function",function(){it("should return true if one form is dirty",inject(function(){e.forms.push({$dirty:!0},{$dirty:!1}),expect(e.hasDirty()).toBeTruthy()})),it("should return false if there are no forms",inject(function(){expect(e.hasDirty()).toBeFalsy()})),it("should return false if none of the forms are dirty",inject(function(){e.forms.push({$dirty:!1},{$dirty:!1}),expect(e.hasDirty()).toBeFalsy()}))}),describe("confirmIfDirty function",function(){it("should check the hasDirty function",inject(function(){spyOn(e,"hasDirty"),e.confirmIfDirty(angular.noop),expect(e.hasDirty).toHaveBeenCalled()})),it("should call Alert.confirm if there is a dirty form",inject(["Alert",function(t){spyOn(t,"confirm"),spyOn(e,"hasDirty").and.returnValue(!0),e.confirmIfDirty(angular.noop),expect(t.confirm).toHaveBeenCalled()}])),it("should call the given function if confirm returns cancel",inject(["Alert",function(t){spyOn(t,"confirm").and.callFake(function(e,t,n){n()}),spyOn(e,"hasDirty").and.returnValue(!0);var n=jasmine.createSpy("okcallback");e.confirmIfDirty(n),expect(n).not.toHaveBeenCalled()}])),it("should do nothing if the confirm returns ok",inject(["Alert",function(t){spyOn(t,"confirm").and.callFake(function(e,t){t()}),spyOn(e,"hasDirty").and.returnValue(!0);var n=jasmine.createSpy("okcallback");e.confirmIfDirty(n),expect(n).toHaveBeenCalled()}])),it("should not show the confirm alert if no forms are dirty",inject(["Alert",function(t){spyOn(t,"confirm"),spyOn(e,"hasDirty").and.returnValue(!1),e.confirmIfDirty(angular.noop),expect(t.confirm).not.toHaveBeenCalled()}])),it("should immediately call the given function if no forms are dirty",inject([function(){spyOn(e,"hasDirty").and.returnValue(!1);var t=jasmine.createSpy("okcallback");e.confirmIfDirty(t),expect(t).toHaveBeenCalled()}]))})}),function(){"use strict";var e=function(e,t,n){return{seed:function(o,i){var r,a,l,s,c,u,d,f,h,p="10f15d80-0052-11e5-b68b-fb65b1fe22e1";return e.get("http://localhost:9080/v1/regions").then(function(t){return r=t.data.result[0].id,console.log("-- TITAN_REGION_ID --",r),e.post("http://localhost:9080/v1/login",{email:"titan@liveops.com",password:"gKVnfF9wrs6XPSYs"})}).then(function(t){return a=t.data.result.user.id,console.log("-- TITAN_ADMIN_ID --",a),e.post("http://localhost:9080/v1/users",{createdBy:a,email:o,password:i,firstName:"Test",lastName:"User",status:"enabled",externalId:"00000000-0000-0000-000000000000"})}).then(function(t){return l=t.data.result.id,s=t.data.result.email,console.log("-- CREATED_USER_ID --",l),console.log("-- CREATED_USER_EMAIL --",s),e.post("http://localhost:9080/v1/tenants",{adminUserId:l,createdBy:a,description:"This is a test tenant created by the seed service.",name:"Test Tenant",regionId:r})}).then(function(t){return c=t.data.result.id,console.log("-- CREATED TENANT ID --",c),e.post("http://localhost:9080/v1/tenants/"+c+"/invites",{roleId:p,email:s})}).then(function(r){return u=r.data.result.invitation.invitationToken,console.log("-- CREATED_INVITE_TOKEN --",u),console.log("-- LOG IN AS NEW USER --"),n(function(){t.login(o,i).then(function(){return e.get("http://localhost:9080/v1/tenants/"+c+"/invites/"+l+"/accept?token="+u)}).then(function(t){return h=t.data.result,console.log("-- ACCEPTED_INVITE_STATUS --",h),e.post("http://localhost:9080/v1/tenants/"+c+"/flows",{createdBy:l,description:"Test flow description.",name:"Test flow",tenantId:c,type:"customer"})}).then(function(t){return d=t.data.result.id,console.log("-- CREATED_FLOW_ID --",d),e.post("http://localhost:9080/v1/tenants/"+c+"/flows/"+d+"/versions",{createdBy:l,description:"Initial Version.",name:"v1",flowId:d,tenantId:c,flow:"[]"})}).then(function(e){f=e.data.result.version,console.log("-- CREATED VERSION ID --",f),console.log('\n\n Done seeding DB with all necessary data to access the flows screen. Log in as the user "'+o+'" with the password "'+i+'" and access the flows screen and go to town :)')})},5e3),t.login(o,i)})}}};angular.module("liveopsConfigPanel.shared.services").service("flowSetup",e)}(),angular.module("liveopsConfigPanel.shared.directives.shared.directives").directive("apiError",function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){o.$parsers.unshift(function(e){return o.$setValidity("api",!0),e})}}}),describe("apiError directive",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.directives.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope","$httpBackend","apiHostname",function(n,o,i,r){e=o.$new(),t=n,i.when("GET",r+"/v1/regions").respond({result:[{id:"c98f5fc0-f91a-11e4-a64e-7f6e9992be1f",description:"US East (N. Virginia)",name:"us-east-1"}]}),i.when("POST",r+"/v1/login").respond({result:{tenants:[]}})}])),it("should set the inputs to valid initially",inject(function(){e.myInput=5;var n=t('<ng-form name="myForm"><input name="myInput" ng-model="myInput" api-error></input></ng-form>')(e);e.$digest(),e.myForm.myInput.$setViewValue("10"),e.$digest(),expect(n.find("input").hasClass("ng-valid-api")).toBeTruthy()}))}),angular.module("liveopsConfigPanel.shared.directives").directive("auditText",["$filter","TenantUser","Session",function(e,t,n){return{restrict:"AE",scope:{translation:"@",userId:"=",date:"="},template:"{{get()}}",link:function(o){o.get=function(){if(!o.userId)return e("translate")(o.translation,{date:e("date")(o.date,"medium")});var i=t.cachedGet({id:o.userId,tenantId:n.tenant.tenantId},"AuditTextUsers");return i.$resolved&&(o.text=e("translate")(o.translation,{displayName:i.getDisplay(),date:e("date")(o.date,"medium")})),o.text}}}}]),describe("auditText directive",function(){var e,t,n,o;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content.management.users")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content.management.tenantUsers")),beforeEach(module("pascalprecht.translate",function(e){e.translations("en",{"value.displayName":"{{displayName}}","plain.value":"A string"}),e.preferredLanguage("en")})),beforeEach(inject(["$compile","$rootScope","mockUsers",function(n,o,i){e=o.$new(),t=n,e.user=i[0]}])),describe("refresh function",function(){it("should do a plain translate if not given a userId",function(){n=t('<audit-text translation="plain.value"></audit-text>')(e),e.$digest(),o=n.isolateScope();var i=o.get();expect(i).toEqual("A string")}),it("should translate the displayname with the one returned by tenantuser cache",inject(["$httpBackend","$q","TenantUser","apiHostname","mockTenantUsers",function(i,r,a,l,s){i.expect("GET",l+"/v1/tenants/tenant-id/users/userId1").respond(s[0]),n=t('<audit-text translation="value.displayName" user-id="user.id"></audit-text>')(e),e.$digest(),o=n.isolateScope(),o.get(),i.flush(),expect(o.text).toEqual("Munoz Lowe")}]))})}),angular.module("liveopsConfigPanel.shared.directives").directive("autocomplete",["filterFilter","$timeout",function(e,t){return{restrict:"E",scope:{items:"=",nameField:"@",onSelect:"&",prefill:"=",isRequired:"=",placeholder:"@",hover:"=",keepExpanded:"=",onEnter:"&"},templateUrl:"app/shared/directives/autocomplete/autocomplete.html",link:function(n){n.currentText=n.prefill||"",n.$watch("currentText",function(){var o;if(n.nameField){var i=n.filterCriteria={};i[n.nameField]=n.currentText,o=e(n.items,i,!0)}t(function(){n.onSelect({currentText:n.currentText})})}),n.select=function(e){n.hovering=!1,n.currentText=e.content},n.onBlur=function(){n.keepExpanded||(n.showSuggestions=!1)}}}}]),describe("autocomplete directive",function(){var e,t,n,o,i,r;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope","$timeout",function(a,l,s){t=a,e=l.$new(),r=s,e.items=[{content:"firstItem",extraProp:"true"},{content:"secondItem"},{content:"secondItemAgain"},{content:"thirdItem"}],e.selectFunction=function(){},i=function(){n=t('<autocomplete items="items" name-field="content" on-select="selectFunction()" is-required="required" placeholder="Type here" hover="hover"></autocomplete>')(e),e.$digest(),o=n.isolateScope()}}])),it("should set item to empty string if there is no text",function(){i(),e.currentText="",e.$digest(),expect(o.currentText).toEqual("")}),it("should set item to empty string if there is only whitespace",function(){i(),e.currentText="                 ",e.$digest(),expect(o.currentText).toEqual("")}),it("should do nothing if selected item changes to an object",function(){i(),o.currentText="some text",e.selectedItem={id:"5"},e.$digest(),expect(o.currentText).toEqual("some text")}),describe("currentText watch",function(){it("should a new string if currentText has no matches",function(){i(),o.currentText="something new",o.$digest(),expect(o.currentText).toEqual("something new")}),it("should call onSelect if given",function(){i(),spyOn(e,"selectFunction"),o.currentText="firstItem",o.$digest(),r.flush(),expect(e.selectFunction).toHaveBeenCalled()}),it("should not call onSelect if not given",function(){n=t('<autocomplete items="items" name-field="content" selected-item="selected" is-required="required" placeholder="Type here" hover="hover"></autocomplete>')(e),e.$digest(),o=n.isolateScope(),spyOn(e,"selectFunction"),o.currentText="firstItem",o.$digest(),expect(e.selectFunction).not.toHaveBeenCalled()}),it("should not call onSelect if no match",function(){i(),spyOn(e,"selectFunction"),o.currentText="A weird entry",o.$digest(),expect(e.selectFunction).not.toHaveBeenCalled()})}),describe("select function",function(){it("should set the current text/selection",function(){i(),o.select({content:"new item"}),expect(o.currentText).toEqual("new item")}),it("should clear hovering",function(){i(),o.select({content:"new item"}),expect(o.hovering).toEqual(!1)})})}),angular.module("liveopsConfigPanel.shared.directives").service("BulkAction",["$q",function(e){var t=function(){this.checked=!1};return t.prototype.reset=function(){this.checked=!1},t.prototype.apply=function(){},t.prototype.execute=function(t){var n=[],o=this;return angular.forEach(t,function(t){n.push(e.when(o.apply(t)))}),e.all(n)},t.prototype.canExecute=function(){return!0},t}]),angular.module("liveopsConfigPanel.shared.directives").directive("bulkActionExecutor",["$q","Alert","Modal","$translate","DirtyForms","$filter",function(e,t,n,o,i,r){return{restrict:"AE",replace:!0,scope:{items:"=",bulkActions:"=",showBulkActions:"=",dropOrderBy:"@",confirmMessageKey:"@"},transclude:!0,templateUrl:"app/shared/directives/bulkActionExecutor/bulkActionExecutor.html",link:function(a){a.confirmMessageKey||(a.confirmMessageKey="bulkActions.confirm.message"),a.checkedItems=[],a.confirmExecute=function(){n.showConfirm({title:o.instant("bulkActions.confirm.title"),message:o.instant(a.confirmMessageKey,{numItems:a.selectedItems().length}),okCallback:a.execute})},a.closeBulk=function(){i.confirmIfDirty(function(){a.$emit("details:panel:close")})},a.execute=function(){var n=a.getSelectedBulkActions(a.bulkActions),i=[];angular.forEach(n,function(t){if(t.canExecute()){var n=a.getSelectedBulkActions(a.items);i.push(e.when(t.execute(n)))}});var r=e.all(i).then(function(){t.success(o.instant("bulkAction.success")),a.resetForm()});return r},a.canExecute=function(){var e=a.getSelectedBulkActions(a.bulkActions),t=!!e.length;return 0===a.selectedItems().length?!1:(angular.forEach(e,function(e){t=t&&e.canExecute()}),t)},a.getSelectedBulkActions=function(e){var t=[];return angular.forEach(e,function(e){e.checked&&t.push(e)}),t},a.selectedItems=function(){if(a.checkedItems.clear(),angular.forEach(a.items,function(e){e.checked&&a.checkedItems.push(e)}),a.dropOrderBy){var e=r("orderBy")(a.checkedItems,a.dropOrderBy);a.checkedItems.clear(),a.checkedItems.push.apply(a.checkedItems,e)}return a.checkedItems},a.cancel=function(){i.confirmIfDirty(function(){a.bulkActionForm.$dirty?a.resetForm():a.closeBulk()})},a.resetForm=function(){a.bulkActionForm.$setUntouched(),a.bulkActionForm.$setPristine(),angular.forEach(a.bulkActions,function(e){e.reset()})},a.$watch("showBulkActions",function(e){e||a.resetForm()})}}}]),angular.module("liveopsConfigPanel.shared.directives.mock.shared.directives.bulkAction",["liveopsConfigPanel.shared.directives.mock.content"]).service("mockBulkActions",function(e){var t=[new e];return t[0].checked=!0,spyOn(t[0],"execute"),spyOn(t[0],"canExecute").and.returnValue(!0),t.push(new e),t[1].checked=!0,spyOn(t[1],"execute"),spyOn(t[1],"canExecute").and.returnValue(!1),t}),describe("bulkActionExecutor directive",function(){var e,t;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.shared.directives.bulkAction")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content.management.users")),beforeEach(inject(["$rootScope",function(t){e=t.$new()}])),beforeEach(inject(["$compile","BulkAction","mockBulkActions","mockUsers",function(n,o,i,r){e.items=r,e.items[0].checked=!0,e.items[1].checked=!0,e.items[2].checked=!1,e.bulkActions=i,e.showBulkActions=!0;var a=n('<bulk-action-executor items="items" bulk-actions="bulkActions" show-bulk-actions="showBulkActions"></bulk-action-executor>')(e);e.$digest(),t=a.isolateScope()}])),describe("ON execute",function(){it("should call execute for all checked items",inject([function(){t.execute(),expect(t.bulkActions[0].execute).toHaveBeenCalledWith([t.items[0],t.items[1]]),expect(t.bulkActions[1].execute).not.toHaveBeenCalled()}])),it("should not call execute for unchecked bulkAction",inject([function(){t.execute(),expect(t.bulkActions[1].execute).not.toHaveBeenCalled()}])),it("should call Alert when all promises resolve",inject(["$httpBackend","Alert",function(e,n){spyOn(n,"success"),t.execute(),t.$digest(),expect(n.success).toHaveBeenCalled()}]))}),describe("ON canExecute",function(){it("should return false if no bulkActions are checked",function(){t.bulkActions[0].checked=!1,t.bulkActions[1].checked=!1,t.bulkActions[0].canExecute=jasmine.createSpy(),t.bulkActions[1].canExecute=jasmine.createSpy();var e=t.canExecute();expect(e).toBeFalsy(),expect(t.bulkActions[0].canExecute).not.toHaveBeenCalled(),expect(t.bulkActions[1].canExecute).not.toHaveBeenCalled()}),it("should return false any checked bulkAction.canExecute returns false",function(){t.bulkActions[0].checked=!0,t.bulkActions[1].checked=!0,t.bulkActions[0].canExecute=jasmine.createSpy().and.returnValue(!0),t.bulkActions[1].canExecute=jasmine.createSpy().and.returnValue(!1);var e=t.canExecute();expect(e).toBeFalsy(),expect(t.bulkActions[0].canExecute).toHaveBeenCalled(),expect(t.bulkActions[1].canExecute).toHaveBeenCalled()}),it("should return false any checked bulkAction.canExecute returns false",function(){t.bulkActions[0].checked=!0,t.bulkActions[1].checked=!0,t.bulkActions[0].canExecute=jasmine.createSpy().and.returnValue(!0),t.bulkActions[1].canExecute=jasmine.createSpy().and.returnValue(!0);var e=t.canExecute();expect(e).toBeTruthy(),expect(t.bulkActions[0].canExecute).toHaveBeenCalled(),expect(t.bulkActions[1].canExecute).toHaveBeenCalled()})}),describe("ON selectedItems",function(){it("should return all checked items",function(){var e=t.selectedItems();expect(e.length).toEqual(2)}),it("should never break the $scope.checkedItems reference",function(){var e=t.selectedItems();expect(e).toBe(e)}),it("should return items in order, if given dropOrderBy",function(){e.items[0].sortField=2,e.items[1].sortField=1,e.items[2].sortField=3,t.dropOrderBy="sortField";var n=t.selectedItems();expect(n[0]).toBe(e.items[1]),expect(n[1]).toBe(e.items[0])})}),describe("showBulkActions watch",function(){it("should call reset form is showBulkActions becomes false",function(){spyOn(t,"resetForm"),t.showBulkActions=!1,t.$digest(),expect(t.resetForm).toHaveBeenCalled()}),it("should not reset the form if showBulkActions becomes true",function(){spyOn(t,"resetForm"),t.showBulkActions=!0,t.$digest(),expect(t.resetForm).not.toHaveBeenCalled()})})}),angular.module("liveopsConfigPanel.shared.directives").directive("loCancelChainExecutor",["$parse","Chain",function(e,t){return{restrict:"A",require:["^loFormCancel"],link:function(e,n,o,i){o.event=angular.isDefined(o.event)?o.event:"click",n.bind(o.event,function(){var n=t.get(o.loCancelChainExecutor);
n.hook("cancel",function(){return i[0].cancel()}),n.execute(),e.$apply()})}}}]),describe("loCancelChainExecutor directive",function(){var e,t,n;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content"));var o;beforeEach(inject(["Chain",function(e){o={execute:jasmine.createSpy("chain execute"),hook:jasmine.createSpy("chain hook")},spyOn(e,"get").and.returnValue(o)}])),describe("ON default event click",function(){beforeEach(inject(["$compile","$rootScope",function(o,i){e=i.$new(),e.event=void 0,t=o('<lo-details-panel><ng-form name="form1" lo-form-cancel ng-resource><a lo-cancel-chain-executor="chain1"></a><ng-form></<lo-details-panel>')(e),e.$digest(),n=t.isolateScope()}])),it("should execute on click",function(){t.find("a").triggerHandler("click"),expect(o.execute).toHaveBeenCalled()})}),describe("ON event dblclick",function(){beforeEach(inject(["$compile","$rootScope",function(o,i){e=i.$new(),e.event=void 0,t=o('<lo-details-panel><ng-form name="form1" lo-form-cancel ng-resource><a event="dblclick" lo-cancel-chain-executor="chain1"></a><ng-form></<lo-details-panel>')(e),e.$digest(),n=t.isolateScope()}])),it("should execute on dblclick",function(){t.find("a").triggerHandler("dblclick"),expect(o.execute).toHaveBeenCalled()}),it("should not execute on click",function(){t.find("a").triggerHandler("click"),expect(o.execute).not.toHaveBeenCalled()})})}),angular.module("liveopsConfigPanel.shared.directives").directive("loChainExecutor",["$parse","Chain",function(e,t){return{restrict:"A",link:function(e,n,o){o.event=angular.isDefined(o.event)?o.event:"click",n.bind(o.event,function(){var n=o.loChainExecutor;t.get(n).execute(),e.$apply()})}}}]),angular.module("liveopsConfigPanel.shared.directives").directive("loSubmitChainExecutor",["$parse","Chain",function(e,t){return{restrict:"A",require:["^loFormSubmit"],link:function(e,n,o,i){o.event=angular.isDefined(o.event)?o.event:"click",n.bind(o.event,function(){var n=t.get(o.loSubmitChainExecutor);n.hook("post form submit",{success:function(e){return i[0].resetForm(),e},failure:function(e){return i[0].populateApiErrors(e),e}}),n.hook("emit event",{success:function(t){e.$emit("form:submit:success",t)},failure:function(t){e.$emit("form:submit:failure",t)}}),n.execute(),e.$apply()})}}}]),describe("loSubmitChainExecutor directive",function(){var e,t,n;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content"));var o;beforeEach(inject(["Chain",function(e){o={execute:jasmine.createSpy("chain execute"),hook:jasmine.createSpy("chain hook")},spyOn(e,"get").and.returnValue(o)}])),describe("ON default event click",function(){beforeEach(inject(["$compile","$rootScope",function(o,i){e=i.$new(),e.event=void 0,t=o('<lo-details-panel><ng-form name="form1" lo-form-cancel lo-form-submit ng-resource><a lo-cancel-chain-executor="chain1"></a><ng-form></<lo-details-panel>')(e),e.$digest(),n=t.isolateScope()}])),it("should execute on click",function(){t.find("a").triggerHandler("click"),expect(o.execute).toHaveBeenCalled()})}),describe("ON event dblclick",function(){beforeEach(inject(["$compile","$rootScope",function(o,i){e=i.$new(),e.event=void 0,t=o('<lo-details-panel><ng-form name="form1" lo-form-cancel lo-form-submit ng-resource><a event="dblclick" lo-cancel-chain-executor="chain1"></a><ng-form></<lo-details-panel>')(e),e.$digest(),n=t.isolateScope()}])),it("should execute on dblclick",function(){t.find("a").triggerHandler("dblclick"),expect(o.execute).toHaveBeenCalled()}),it("should not execute on click",function(){t.find("a").triggerHandler("click"),expect(o.execute).not.toHaveBeenCalled()})})}),angular.module("liveopsConfigPanel.shared.directives").directive("compiledInclude",["$compile","$templateCache","$http","$q",function(e,t,n,o){return{restrict:"A",priority:400,compile:function(){return function(i,r,a){var l=a.compiledInclude,s=t.get(l);s||(s=n.get(l,{cache:t}).then(function(e){return t.put(l,e.data),e.data})),o.when(s).then(function(t){r.html(t),e(r.contents())(i)})}}}}]),describe("concatStrings directive",function(){var e,t,n,o;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope","$templateCache","$httpBackend",function(i,r,a,l){e=r.$new(),t=i,n=a,o=l}])),it("should retrieve a template from cache and make it the content of its element",inject(function(){n.put("thing.html","Hello");var o=t('<div compiled-include="thing.html"></div>')(e);e.$digest(),expect(o.text()).toEqual("Hello")})),it("should make a GET to retrieve the template, place it in cache, and make it the content of its element",inject(function(){o.expectGET("other.html").respond(200,"Goodbye");var i=t('<div compiled-include="other.html"></div>')(e);e.$digest(),o.flush(),expect(i.text()).toEqual("Goodbye"),expect(n.get("other.html")).toEqual("Goodbye")}))}),angular.module("liveopsConfigPanel.shared.directives").directive("loCancel",["$q",function(e){return{restrict:"A",require:["^loFormCancel"],link:function(t,n,o,i){o.event=angular.isDefined(o.event)?o.event:"click",n.bind(o.event,function(){var n=e.when(t.$eval(o.loCancel));n.then(function(){return i[0].cancel()}),t.$apply()})}}}]),angular.module("liveopsConfigPanel.shared.directives").directive("loFormAlert",["$parse","Alert",function(e,t){return{restrict:"A",require:["loFormSubmit"],controller:function(){this.alertSuccess=function(e){var n=e.updated?"updated":"saved";t.success("Record "+n)},this.alertFailure=function(e){var n=e.updated?"update":"save";t.error("Record failed to "+n)}},link:function(e,t){e.$on("form:submit:success",function(e,n){var o=t.data("$loFormAlertController");o.alertSuccess(n)}),e.$on("form:submit:failure",function(e,n){var o=t.data("$loFormAlertController");o.alertFailure(n)})}}}]),describe("loFormAlert directive",function(){var e,t;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope",function(n,o){e=o.$new(),e.ngResource={isNew:jasmine.createSpy("ngResource.isNew"),reset:jasmine.createSpy("ngResource.reset"),email:"test@tester.com"};var i=angular.element('<div><ng-form name="form1" lo-form-submit="chain1" lo-form-cancel="" ng-resource="ngResource" lo-form-alert></ng-form></div>');i.data("$loDetailsPanelController",{close:jasmine.createSpy()}),n(i)(e),e.$digest(),t=i.find("ng-form").scope()}])),beforeEach(inject(["Alert",function(e){spyOn(e,"success"),spyOn(e,"error")}])),describe("ON form:submit:success",function(){it("should alert with a success message for create",inject(["Alert",function(t){e.$broadcast("form:submit:success",{updated:!1}),expect(t.success).toHaveBeenCalledWith("Record saved")}])),it("should alert with a success message for update",inject(["Alert",function(t){e.$broadcast("form:submit:success",{updated:!0}),expect(t.success).toHaveBeenCalledWith("Record updated")}]))}),describe("ON form:submit:failure",function(){it("should alert with a failure message",inject(["Alert",function(t){e.$broadcast("form:submit:failure",{updated:!1}),expect(t.error).toHaveBeenCalledWith("Record failed to save")}])),it("should alert with a failure message",inject(["Alert",function(t){e.$broadcast("form:submit:failure",{updated:!0}),expect(t.error).toHaveBeenCalledWith("Record failed to update")}]))})}),angular.module("liveopsConfigPanel.shared.directives").directive("loFormCancel",["$parse","Chain","DirtyForms","$timeout","$rootScope",function(e,t,n,o,i){return{restrict:"A",require:["ngResource","form","^loDetailsPanel"],controller:function(t){var r=this;this.resetForm=function(){angular.forEach(r.formController,function(e,t){if(e&&e.hasOwnProperty("$modelValue")&&e.$invalid){var n=e.$modelValue;null===n&&(n=void 0),r.formController[t].$setViewValue(n),r.formController[t].$rollbackViewValue()}}),r.formController.$setPristine(),r.formController.$setUntouched()},this.cancel=function(){var a=e(this.ngResource)(t);a.isNew()||!this.formController.$dirty?this.loDetailsPanelController.close():n.confirmIfDirty(function(){i.$broadcast("cancel:resource:"+a.resourceName),a.reset(),o(function(){r.resetForm(r.formController)})})}},link:function(t,n,o,i){t.$watch(o.ngResource,function(i,r){r&&r.reset();var a=e(o.name)(t),l=n.data("$loFormCancelController");l.resetForm(a)});var r=n.data("$loFormCancelController");r.ngResource=o.ngResource,r.formController=i[1],r.loDetailsPanelController=i[2]}}}]),describe("loFormCancel directive",function(){var e,t,n,o;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope","DirtyForms",function(i,r,a){e=r.$new(),e.ngResource={email:"test@tester.com",isNew:jasmine.createSpy("ngResource.isNew").and.callThrough(),reset:jasmine.createSpy("ngResource.isNew").and.callThrough()},t=angular.element('<div><ng-form ng-resource="ngResource" lo-form-cancel="chain1" name="form1"><input ng-model="ngResource.email" name="email" type="email" required></ng-form></div>'),t.data("$loDetailsPanelController",{close:jasmine.createSpy()}),i(t)(e),e.$digest(),n=t.find("ng-form").scope(),o=t.find("ng-form").controller("loFormCancel"),spyOn(a,"confirmIfDirty").and.callFake(function(e){e()})}])),beforeEach(function(){n.ngResource.isNew=jasmine.createSpy("ngResource.isNew"),n.ngResource.reset=jasmine.createSpy("ngResource.reset")}),describe("ON ngResource change",function(){beforeEach(function(){o.resetForm=jasmine.createSpy("loFormCancelController.resetForm")}),it("should call resetForm on ngResource change",function(){var e=n.ngResource;n.ngResource={isNew:jasmine.createSpy("new ngResource.isNew"),reset:jasmine.createSpy("new ngResource.reset"),email:"new@tester.com"},n.$digest(),expect(o.resetForm).toHaveBeenCalled(),expect(e.reset).toHaveBeenCalled()})}),describe("ON controller.resetForm",function(){var e;beforeEach(function(){e=t.find("ng-form").controller("form"),spyOn(e,"$setPristine"),spyOn(e,"$setUntouched"),spyOn(e.email,"$setViewValue"),spyOn(e.email,"$rollbackViewValue")}),it("should always $setPristine and $setUntouched on call",function(){o.resetForm(e),expect(e.$setPristine).toHaveBeenCalled(),expect(e.$setUntouched).toHaveBeenCalled()}),it("should not $setViewValue to displayValue and $rollbackViewValue if field is valid",function(){o.resetForm(e),expect(e.email.$setViewValue).not.toHaveBeenCalled(),expect(e.email.$rollbackViewValue).not.toHaveBeenCalled()}),it("should $setViewValue to displayValue and $rollbackViewValue if field is invalid",function(){n.ngResource.email="test@",n.$digest(),o.resetForm(e),expect(e.$setPristine).toHaveBeenCalled(),expect(e.$setUntouched).toHaveBeenCalled(),expect(e.email.$setViewValue).toHaveBeenCalled(),expect(e.email.$rollbackViewValue).toHaveBeenCalled()}),it("should $setViewValue to undefined if displayValue is null",function(){n.ngResource.email=null,n.$digest(),o.resetForm(e),expect(e.$setPristine).toHaveBeenCalled(),expect(e.$setUntouched).toHaveBeenCalled(),expect(e.email.$setViewValue).toHaveBeenCalledWith(void 0),expect(e.email.$rollbackViewValue).toHaveBeenCalled()})}),describe("ON controller.cancel",function(){beforeEach(function(){spyOn(o,"resetForm")}),describe("WHERE ngResource is new",function(){beforeEach(function(){n.ngResource.isNew=jasmine.createSpy("ngReource.isNew").and.returnValue(!0)}),it("should call detailsPanel.close when form is clean",inject([function(){expect(n.ngResource.reset).not.toHaveBeenCalled(),o.cancel(),expect(t.controller("loDetailsPanel").close).toHaveBeenCalled(),expect(o.resetForm).not.toHaveBeenCalled(),expect(n.ngResource.reset).not.toHaveBeenCalled()}])),it("should not call detailsPanel.close when form is dirty",inject([function(){t.find("ng-form").controller("form").$setDirty(),o.cancel(),expect(t.controller("loDetailsPanel").close).toHaveBeenCalled(),expect(o.resetForm).not.toHaveBeenCalled(),expect(n.ngResource.reset).not.toHaveBeenCalled()}]))}),describe("WHERE ngResource is not new and form is dirty",function(){beforeEach(function(){n.ngResource.isNew=jasmine.createSpy("ngReource.isNew").and.returnValue(!1),t.find("ng-form").controller("form").$setDirty()}),it("should call loFormCancel.resetForm and resource.reset",inject(["$timeout",function(e){o.cancel(),e.flush(),expect(o.resetForm).toHaveBeenCalled(),expect(n.ngResource.reset).toHaveBeenCalled()}]))})})}),angular.module("liveopsConfigPanel.shared.directives").directive("loFormReset",[function(){return{restrict:"A",require:"form",controller:function(){var e=this;this.resetForm=function(){angular.forEach(e.formController,function(t,n){if(t&&t.hasOwnProperty("$modelValue")&&t.$invalid){var o=t.$modelValue;null===o&&(o=void 0),e.formController[n].$setViewValue(o),e.formController[n].$rollbackViewValue()}}),e.formController.$setPristine(),e.formController.$setUntouched()}},link:function(e,t,n,o){var i=t.data("$loFormResetController");i.formController=o}}}]),angular.module("liveopsConfigPanel.shared.directives").directive("loFormSubmit",["$parse","Chain",function(e){return{restrict:"A",require:"form",controller:function(t){var n=this;n.errorInputWatchesUnbinds={},this.populateApiErrors=function(o){return e("data.error")(o)&&angular.forEach(o.data.error.attribute,function(e,o){n.formController[o].$setValidity("api",!1),n.formController[o].$error={api:e},n.formController[o].$setTouched(),n.formController[o].$setPristine(),n.errorInputWatchesUnbinds[o]=t.$watch(function(){return n.formController[o].$dirty},function(e){e&&(n.formController[o].$setValidity("api",!0),n.errorInputWatchesUnbinds[o](),delete n.errorInputWatchesUnbinds[o])})}),o}},link:function(e,t,n,o){var i=t.data("$loFormSubmitController");i.formController=o}}}]),describe("loFormSubmit directive",function(){var e,t,n,o,i;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$rootScope",function(t){e=t.$new(),e.ngResource={email:"test@tester.com",isNew:jasmine.createSpy("ngResource.isNew"),reset:jasmine.createSpy("ngResource.reset")},i='<div><ng-form ng-resource="ngResource" lo-form-submit="chain1"lo-form-cancel name="form1"><input ng-model="ngResource.email" name="email" type="email" required></ng-form></div>'}])),describe("ON populateApiErrors",function(){var r,a;beforeEach(inject(["$compile",function(l){r={data:{error:{attribute:{email:"Invalid email."}}}},t=angular.element(i),t.data("$loDetailsPanelController",{close:jasmine.createSpy()}),l(t)(e),e.$digest(),n=t.find("ng-form").scope(),a=t.find("ng-form").controller("form"),o=t.find("ng-form").controller("loFormSubmit")}])),it("should $setValidity for field",inject(["$timeout",function(e){spyOn(a.email,"$setValidity"),o.populateApiErrors(r),e.flush(),expect(a.email.$setValidity).toHaveBeenCalledWith("api",!1)}])),it("should set $error for field",inject(["$timeout",function(e){o.populateApiErrors(r),e.flush(),expect(a.email.$error).toEqual({api:"Invalid email."})}])),it("should $setTouched for field",inject(["$timeout",function(e){spyOn(a.email,"$setTouched"),o.populateApiErrors(r),e.flush(),expect(a.email.$setTouched).toHaveBeenCalled()}])),it("should do nothing if error is none-standard",inject(["$timeout",function(e){r.data=void 0,spyOn(a.email,"$setValidity"),spyOn(a.email,"$setTouched"),o.populateApiErrors(r),e.flush(),expect(a.email.$setValidity).not.toHaveBeenCalled(),expect(a.email.$setTouched).not.toHaveBeenCalled()}]))})}),angular.module("liveopsConfigPanel.shared.directives").directive("loSubmit",["$q",function(e){return{restrict:"A",require:["^loFormSubmit","?^loFormCancel","?^loFormAlert","?^loFormReset"],link:function(t,n,o,i){o.event=angular.isDefined(o.event)?o.event:"click";var r=i[0],a=i[1],l=i[2],s=i[3];n.bind(o.event,function(){var n=e.when(t.$eval(o.loSubmit));n=n.then(function(e){return a?a.resetForm():s&&s.resetForm(),e},function(t){var n=e.defer();return r.populateApiErrors(t),n.reject(t),n.promise}),n=n.then(function(e){l.alertSuccess(e)},function(e){l.alertFailure(e.config.data)}),t.$apply()})}}}]),angular.module("liveopsConfigPanel.shared.directives").directive("loDetailsPanel",["$location","DirtyForms",function(e,t){return{restrict:"EA",require:["ngResource"],transclude:!0,templateUrl:"app/shared/directives/detailsPanel/detailsPanel.html",scope:{ngResource:"="},controller:function(n){this.close=function(){t.confirmIfDirty(function(){e.search({id:null}),n.ngResource=null,n.$emit("details:panel:close")})},n.close=this.close}}}]),describe("loDetailsPanel directive",function(){var e,t,n;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope","$stateParams",function(o,i,r){e=i.$new(),e.ngResource={},t=o('<lo-details-panel ng-resource="ngResource"></lo-details-panel>')(e),e.$digest(),n=t.isolateScope(),r.id=1}])),describe("ON close",function(){it("should exists",function(){expect(n.close).toBeDefined()}),describe("WHEN confirmIfDirty passes",function(){beforeEach(inject(["DirtyForms",function(e){spyOn(e,"confirmIfDirty").and.callFake(function(e){e()})}])),it("should nullify the $location search id",inject(["$location",function(e){spyOn(e,"search"),n.close(),expect(e.search).toHaveBeenCalledWith({id:null})}])),it("should nullify the ngResource",function(){expect(n.ngResource).not.toBeNull(),n.close(),expect(n.ngResource).toBeNull()})}),describe("WHEN confirmIfDirty fails",function(){beforeEach(inject(["DirtyForms",function(e){spyOn(e,"confirmIfDirty").and.callFake(function(){})}])),it("should not nullify the ngResource",function(){expect(n.ngResource).not.toBeNull(),n.close(),expect(n.ngResource).not.toBeNull()})})})}),angular.module("liveopsConfigPanel.shared.directives").directive("disableContents",[function(){return{compile:function(e,t){var n="input, button, select, textarea, label",o=e.find(n);angular.forEach(o,function(e){e=angular.element(e);var n=e.attr("ng-disabled");n=n?n+" || ":"",n+=t.disableContents,e.attr("ng-disabled",n)})}}}]),describe("disableContents directive",function(){var e,t,n;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope",function(n,o){e=o.$new(),t=n}])),it("should disable all inputs in the element when expression is true",function(){n=t('<div disable-contents="true"><input type="text"></input><input type="url"></input></div>')(e),e.$digest();var o=n.find("input");expect(o.length).toBe(2),expect(o[0].hasAttribute("disabled")).toBeTruthy(),expect(o[1].hasAttribute("disabled")).toBeTruthy()}),it("should not disable inputs in the element when expression is false",function(){n=t('<div disable-contents="false"><input type="text"></input><input type="url"></input></div>')(e),e.$digest();var o=n.find("input");expect(o.length).toBe(2),expect(o[0].hasAttribute("disabled")).toBeFalsy(),expect(o[1].hasAttribute("disabled")).toBeFalsy()}),it("should disable all labels in the element when expression is true",function(){n=t('<div disable-contents="true"><label></label></div>')(e),e.$digest();var o=n.find("label");expect(o.length).toBe(1),expect(o[0].hasAttribute("disabled")).toBeTruthy()}),it("should not disable labels in the element when expression is false",function(){n=t('<div disable-contents="false"><label></label></div>')(e),e.$digest();var o=n.find("label");expect(o.length).toBe(1),expect(o[0].hasAttribute("disabled")).toBeFalsy()}),it("should not overwrite existing ng-disabled attributes",function(){n=t('<div disable-contents="true"><input ng-disabled="myVal"></input></div>')(e),e.$digest();var o=n.find("input");expect(o.length).toBe(1),expect(o.attr("ng-disabled")).toEqual("myVal || true")})}),angular.module("liveopsConfigPanel.shared.directives").controller("DropdownController",["$scope","$document","$element",function(e,t,n){var o=this;e.showDrop=!1,this.setShowDrop=function(t){e.showDrop=t},e.$watch("showDrop",function(e,n){t.off("click",o.onClick),e&&!n&&t.on("click",o.onClick)}),this.onClick=function(i){var r=n.find(i.target).length>0;r||(e.$apply(function(){e.showDrop=!1,e.hovering=!1}),t.off("click",o.onClick))}}]),describe("DropdownController",function(){var e,t,n,o;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(inject(["$rootScope","$controller","$document","$httpBackend","apiHostname",function(i,r,a,l,s){e=i.$new(),t=a,o={},l.when("GET",s+"/v1/regions").respond({}),l.when("POST",s+"/v1/login").respond({}),n=r("DropdownController",{$scope:e,$element:o})}])),it("should hide the dropdown to start",inject(function(){expect(e.showDrop).toBeFalsy()})),it("should attach the click listener when showDrop becomes true",inject(function(){spyOn(t,"on"),e.showDrop=!1,e.$digest(),e.showDrop=!0,e.$digest(),expect(t.on).toHaveBeenCalledWith("click",jasmine.any(Function))})),describe("setShowDrop function",function(){it("should exist",inject(function(){expect(n.setShowDrop).toBeDefined(),expect(n.setShowDrop).toEqual(jasmine.any(Function))})),it("should set the showDrop value",inject(function(){e.showDrop=!1,n.setShowDrop(!0),expect(e.showDrop).toBeTruthy(),e.showDrop=!0,n.setShowDrop(!1),expect(e.showDrop).toBeFalsy()}))}),describe("onClick function",function(){it("should exist",inject(function(){expect(n.onClick).toBeDefined(),expect(n.onClick).toEqual(jasmine.any(Function))})),it("should set showDrop and Hovering to false when clicking outside the element",function(){e.showDrop=!0,e.hovering=!0;var t=jasmine.createSpyObj("$element",["find"]);o.find=t.find.and.returnValue([]),n.onClick({target:{}}),expect(e.showDrop).toBeFalsy(),expect(e.hovering).toBeFalsy()}),it("should remove the click event listener",function(){spyOn(t,"off");var e=jasmine.createSpyObj("$element",["find"]);o.find=e.find.and.returnValue([]),n.onClick({target:{}}),expect(t.off).toHaveBeenCalledWith("click",jasmine.any(Function))}),it("should do noting if clicking inside the element",function(){e.showDrop=!0,e.hovering=!0,spyOn(t,"off");var i=jasmine.createSpyObj("$element",["find"]);o.find=i.find.and.returnValue([!0]),n.onClick({target:{}}),expect(e.showDrop).toBeTruthy(),expect(e.hovering).toBeTruthy(),expect(t.off).not.toHaveBeenCalled()})})}),angular.module("liveopsConfigPanel.shared.directives").directive("dropdown",[function(){return{scope:{items:"=",label:"@",valuePath:"@",displayPath:"@",collapseIcon:"@",expandIcon:"@",orderBy:"@",hovering:"=?",hoverTracker:"=?",showOnHover:"="},templateUrl:"app/shared/directives/dropdown/dropdown.html",controller:"DropdownController",link:function(e,t,n,o){e.valuePath=e.valuePath?e.valuePath:"value",e.displayPath=e.displayPath?e.displayPath:"label","undefined"!=typeof e.hovering&&e.hoverTracker&&e.hoverTracker.push(o),e.clearOtherHovers=function(){angular.forEach(e.hoverTracker,function(e){e!==o&&e.setShowDrop(!1)})},e.orderBy||(e.orderBy="label"),e.optionClick=function(t){e.showDrop=!1,e.hovering=!1,t()},e.collapseIcon||(e.collapseIcon="fa fa-caret-up"),e.expandIcon||(e.expandIcon="fa fa-caret-down"),e.mouseIn=function(){(e.hovering||e.showOnHover)&&(e.showDrop=!0,e.clearOtherHovers())},e.dropClick=function(){e.showDrop=!e.showDrop,e.hovering=!e.hovering}}}}]),describe("dropdown directive",function(){var e,t,n,o,i,r,a;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope","$document",function(o,r,a){e=r.$new(),t=o,n=a,i=[{label:"One"},{label:"Another"}],e.items=i}])),it("should add an li item for each item given",inject(function(){o=t('<dropdown label="My Dropdown" items="items"></dropdown>')(e),e.$digest(),expect(o.find("li").length).toEqual(2)})),describe("optionClick function",function(){beforeEach(function(){o=t('<dropdown label="My Dropdown" items="items"></dropdown>')(e),e.$digest(),r=o.isolateScope()}),it("should call the given function",inject(function(){var e=jasmine.createSpy("optionClick");r.optionClick(e),expect(e).toHaveBeenCalled()})),it("should hide the dropdown",inject(function(){r.showDrop=!0,r.optionClick(angular.noop),expect(r.showDrop).toBeFalsy()}))}),it("should add the controller to hoverTracker if given",inject(function(){e.hovering=!1,e.hovers=[],o=t('<dropdown label="My Dropdown" items="items" hovering="hovering" hover-tracker="hovers"></dropdown>')(e),e.$digest(),r=o.isolateScope(),expect(e.hovers.length).toBe(1)})),describe("clearOtherHovers function",function(){beforeEach(function(){a=jasmine.createSpyObj("controller",["setShowDrop"]),e.hovering=!1,e.hovers=[a],o=t('<dropdown label="My Dropdown" items="items" hovering="hovering" hover-tracker="hovers"></dropdown>')(e),e.$digest(),r=o.isolateScope()}),it("should set show drop to false for all other controllers",inject(function(){r.clearOtherHovers(),expect(a.setShowDrop).toHaveBeenCalledWith(!1)})),it("should leave showdrop intact for the current controller",inject(function(){r.showDrop=!0,r.clearOtherHovers(),expect(r.showDrop).toBeTruthy()}))}),describe("mouseIn function",function(){beforeEach(function(){e.hovering=!1,o=t('<dropdown label="My Dropdown" items="items" hovering="hovering"></dropdown>')(e),e.$digest(),r=o.isolateScope(),spyOn(r,"clearOtherHovers")}),it("should call clearOtherHovers and showDrop when hovering",inject(function(){r.hovering=!0,r.mouseIn(),expect(r.showDrop).toBeTruthy(),expect(r.clearOtherHovers).toHaveBeenCalled()})),it("should do nothing if hovering",inject(function(){r.hovering=!1,r.mouseIn(),expect(r.showDrop).toBeFalsy(),expect(r.clearOtherHovers).not.toHaveBeenCalled()}))}),describe("dropClick function",function(){beforeEach(function(){o=t('<dropdown label="My Dropdown" items="items" hovering="hovering"></dropdown>')(e),e.$digest(),r=o.isolateScope()}),it("should toggle showDrop",inject(function(){r.showDrop=!0,r.dropClick(),expect(r.showDrop).toBeFalsy(),r.showDrop=!1,r.dropClick(),expect(r.showDrop).toBeTruthy()})),it("should toggle hovering",inject(function(){r.hovering=!0,r.dropClick(),expect(r.hovering).toBeFalsy(),r.hovering=!1,r.dropClick(),expect(r.hovering).toBeTruthy()}))})}),angular.module("liveopsConfigPanel.shared.directives").directive("filterDropdown",[function(){return{scope:{id:"@",options:"=",valuePath:"@",displayPath:"@",label:"@",showAll:"@",orderBy:"@"},templateUrl:"app/shared/directives/dropdown/filterDropdown.html",controller:"DropdownController",link:function(e,t){if(t.parent().css("overflow","visible"),e.valuePath=e.valuePath?e.valuePath:"value",e.displayPath=e.displayPath?e.displayPath:"display",e.checkItem=function(t){t.checked=!t.checked,e.$emit("dropdown:item:checked",t)},e.showAll){e.$watch("options",function(){var t=!1;angular.forEach(e.options,function(n){n.checked&&(t=!0,e.all.checked=!1)}),t||(e.all.checked=!0)},!0);var n=!0;angular.forEach(e.options,function(e){n=n&&e.checked}),e.all={checked:n},e.$watch("all.checked",function(){e.all.checked&&angular.forEach(e.options,function(e){e.checked=!1})})}else e.$watch("options",function(){angular.forEach(e.options,function(e){e.checked="undefined"==typeof e.checked?!0:e.checked})})}}}]),describe("filterDropdown directive",function(){var e,t,n,o,i;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope","$httpBackend","apiHostname",function(r,a,l,s){e=a.$new(),n=r,i=[{display:"Disabled",value:"false",checked:!1},{display:"Enabled",value:"true",checked:!1}],e.statuses=i,o=n('<filter-dropdown show-all="true" label="Some Label" options="statuses"></filter-dropdown>')(e),e.$digest(),l.when("GET",s+"/v1/regions").respond({result:[{id:"c98f5fc0-f91a-11e4-a64e-7f6e9992be1f",description:"US East (N. Virginia)",name:"us-east-1"}]}),l.when("POST",s+"/v1/login").respond({result:{tenants:[]}}),t=o.isolateScope()}])),it("should add checkboxes for each filter value, and also one for the all value",inject(function(){expect(o.find("input").length).toEqual(3)})),it('should add the "all" class to the "all" value container',inject(function(){var e=o[0].querySelectorAll(".all");expect(angular.element(e).hasClass("all")).toBe(!0);var t=e[0].querySelectorAll("[name=all]");expect(angular.element(t)).toBeTruthy()})),it("should not add the all field if the filters dont provide one",inject(function(){var t={filters:[{display:"Disabled",value:"false",checked:!1},{display:"Enabled",value:"true",checked:!1}]};e.newStatuses=t,o=n('<filter-dropdown label="Some Label" items="newStatuses"></filter-dropdown>')(e),e.$digest();var i=o[0].querySelectorAll(".all");expect(i.length).toEqual(0)})),it('should uncheck the "all" value when a filter is enabled',inject(function(){expect(t.all.checked).toBe(!0),e.statuses[0].checked=!0,e.$digest()})),it('should check the other filters when "all" is checked',inject(function(){i=[{display:"Disabled",value:"false",checked:!0}],e.statuses=i,o=n('<filter-dropdown show-all="true" label="Some Label" items="statuses"></filter-dropdown>')(e),e.$digest(),t.all.checked=!1,expect(t.all.checked).toBeFalsy(!1),t.all.checked=!0,expect(t.all.checked).toBeTruthy(!1),expect(e.statuses[0].checked).toBeTruthy(!0)})),it("should keep the dropdown hidden by default",inject(function(){var e=o[0].querySelectorAll(".dropdown");expect(angular.element(e).hasClass("ng-hide")).toBe(!0)})),it("should show the dropdown when the label is clicked",inject(function(){o.find(".dropdown-label").click();var e=o[0].querySelectorAll(".dropdown");expect(angular.element(e).hasClass("ng-hide")).toBe(!1)})),it("should hide an already-open dropdown when the label is clicked",inject(function(){o.find(".dropdown-label").click(),o.find(".dropdown-label").click();var e=o[0].querySelectorAll(".dropdown");expect(angular.element(e).hasClass("ng-hide")).toBe(!0)})),it("should update the item.checked value when the check wrapper div is clicked",inject(function(){t.all.checked=!0;var n=o[0].querySelectorAll(".all"),i=angular.element(n);i.click(),expect(t.all.checked).toBeFalsy(),e.statuses[0].checked=!0;var r=o[0].querySelectorAll(".dropdown-option"),a=angular.element(r[0]);a.click(),expect(e.statuses[0].checked).toBeFalsy()}))}),angular.module("liveopsConfigPanel.shared.directives").directive("formError",function(){return{templateUrl:"app/shared/directives/formError/formError.html",scope:{field:"="},link:function(e,t,n){e.errorTypes={},angular.forEach(n.$attr,function(t,o){if(o.match(/errorType+/)){var i=o.replace(/errorType/,""),r=i.charAt(0);i=i.replace(/^\w/,r.toLowerCase()),e.errorTypes[i]=n[o],n.$observe(o,function(t){e.errorTypes[i]=t})}}),e.isString=function(e){return angular.isString(e)}}}}),angular.module("liveopsConfigPanel.shared.directives").controller("EditFieldController",function(e){e.saveHandler=function(t){t&&t.target.blur(),e.$emit("editField:save",{objectId:e.objectId,fieldName:e.name,fieldValue:e.ngModel})},e.$on(e.name+":save",function(){e.edit=!1})}),describe("EditFieldController",function(){var e;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(inject(["$rootScope","$controller",function(t,n){e=t.$new(),n("EditFieldController",{$scope:e})}])),describe("saveHandler function",function(){it("should blur the element on save",inject(function(){var t=!1,n={target:{blur:function(){t=!0}}};e.saveHandler(n),expect(t).toBeTruthy()})),it("should emit the editField:save event",inject(function(){e.objectId=1,e.name="name",e.ngModel="value",spyOn(e,"$emit"),e.saveHandler(),expect(e.$emit).toHaveBeenCalledWith("editField:save",{objectId:1,fieldName:"name",fieldValue:"value"})}))})}),angular.module("liveopsConfigPanel.shared.directives").directive("helpIcon",["$document","$compile",function(e,t){return{templateUrl:"app/shared/directives/helpIcon/helpIcon.html",scope:{text:"@",translateValue:"@"},link:function(n,o){n.target=o;
var i;n.showTooltip=function(){i=t('<tooltip target="target" text="{{text}}" translate-value="{{translateValue}}"></tooltip>')(n),e.find("body").append(i)},n.destroyTooltip=function(){i.remove()}}}}]),describe("helpIcon directive",function(){var e,t,n,o;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope",function(i,r){e=r.$new(),n=i,o=n('<help-icon text="my tooltip text"></help-icon>')(e),e.$digest(),t=o.isolateScope()}])),it("should render an icon",inject(function(){expect(o.find("i").length).toEqual(2),expect(o.find("i").hasClass("fa")).toBeTruthy()})),describe("showTooltip function",function(){it("should append a tooltip to the body",inject(["$document",function(e){var n=jasmine.createSpyObj("mockBody",["append"]);spyOn(e,"find").and.returnValue(n),t.showTooltip(),expect(e.find).toHaveBeenCalledWith("body");var o=n.append.calls.mostRecent().args[0];expect(o[0].outerHTML).toContain("</tooltip>")}]))}),describe("destroyTooltip function",function(){it("should remove the tooltip from the body",inject(["$document",function(e){t.showTooltip(),expect(e.find("tooltip").length).toBe(1),t.destroyTooltip(),expect(e.find("tooltip").length).toBe(0)}]))})}),angular.module("liveopsConfigPanel.shared.directives").directive("highlightOnClick",["$window",function(e){return{restrict:"A",link:function(t,n){n.on("click",function(){e.getSelection().toString()||this.setSelectionRange(0,this.value.length)})}}}]),describe("highlightOnClick directive",function(){var e,t,n;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope","$window",function(o,i,r){e=i.$new(),t=r,e.myInput="hello, world",n=o('<input ng-model="myInput" highlight-on-click></input>')(e),e.$digest()}])),it("should check window.getselection",inject(function(){spyOn(t,"getSelection").and.callThrough(),n.triggerHandler("click"),expect(t.getSelection).toHaveBeenCalled()})),it("should do nothing if the window has something selected",inject(function(){spyOn(t,"getSelection").and.callFake(function(){return"A prior selection"}),n.triggerHandler("click"),expect(t.getSelection()).toEqual("A prior selection")}))}),angular.module("liveopsConfigPanel.shared.directives").directive("loMultibox",["$timeout",function(e){return{restrict:"E",scope:{items:"=",selectedItem:"=",resourceName:"@",name:"@",onItemSelect:"="},templateUrl:"app/shared/directives/loMultibox/loMultibox.html",controller:"DropdownController",link:function(t,n,o,i){t.onSelect=function(e){angular.isString(e)||(t.display=e.getDisplay(),angular.isFunction(t.onItemSelect)&&t.onItemSelect(e),i.setShowDrop(!1),t.createMode=!1)},t.createItem=function(){t.$emit("resource:details:create:"+t.resourceName,t.selectedItem),t.createMode=!0},t.labelClick=function(){i.setShowDrop(!t.showDrop),t.selectedItem=null,t.showDrop&&e(function(){var e=n.find("type-ahead input");e.focus()})},t.$watch("selectedItem",function(e){angular.isString(e)||e&&angular.isFunction(e.getDisplay)&&(t.display=e.getDisplay())},!0),t.$on("resource:details:"+t.resourceName+":canceled",function(){t.createMode=!1}),t.$on("created:resource:"+t.resourceName,function(e,n){t.createMode&&t.onSelect(n)})}}}]),describe("loMultibox directive",function(){var e,t,n,o;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope",function(i,r){e=r.$new(),o=r,e.items=[{displayname:"the first",id:"123",otherprop:"Red",getDisplay:jasmine.createSpy("getDisplay").and.returnValue("the first")},{displayname:"second",id:"456",otherprop:"Blue",getDisplay:jasmine.createSpy("getDisplay").and.returnValue("second")},{displayname:"3",id:"789",otherprop:"Yellow",getDisplay:jasmine.createSpy("getDisplay").and.returnValue("3")}],e.selectedItem=e.items[1],t=i('<lo-multibox items="items" selected-item="selectedItem" resource-name="myresource"></lo-multibox>')(e),e.$digest(),n=t.isolateScope()}])),it("should add a typeahead field",inject(function(){expect(t.find("type-ahead").length).toEqual(1)})),it("should catch create event and select the created resource, if in create mode",inject([function(){var e={displayname:"fourth",id:"new",otherprop:"Aqua"};n.createMode=!0,spyOn(n,"onSelect"),o.$broadcast("created:resource:myresource",e),n.$digest(),expect(n.onSelect).toHaveBeenCalledWith(e)}])),it("should catch create event but do nothing if not in create mode",function(){n.createMode=!1,spyOn(n,"onSelect"),o.$broadcast("created:resource:myresource",{}),n.$digest(),expect(n.onSelect).not.toHaveBeenCalled()}),it("should catch cancel event and disable create mode",function(){n.createMode=!0,o.$broadcast("resource:details:myresource:canceled",{}),n.$digest(),expect(n.createMode).toBeFalsy()}),describe("onSelect function",function(){it("should disable edit and showDrop modes",inject(function(){n.showDrop=!0,n.createMode=!0,n.onSelect({getDisplay:jasmine.createSpy("getDisplay").and.returnValue("1234"),id:"1234"}),e.$digest(),expect(n.showDrop).toBeFalsy(),expect(n.createMode).toBeFalsy()}))}),describe("createItem function",function(){it("should exist",function(){expect(n.createItem).toBeDefined(),expect(n.createItem).toEqual(jasmine.any(Function))}),it("should emit the create event",inject(function(){spyOn(n,"$emit"),n.createItem(),expect(n.$emit).toHaveBeenCalledWith("resource:details:create:myresource",jasmine.any(Object))}))}),describe("labelClick function",function(){it("should exist",function(){expect(n.labelClick).toBeDefined(),expect(n.labelClick).toEqual(jasmine.any(Function))}),it("should toggle showDrop",inject(function(){n.showDrop=!0,n.labelClick(),expect(n.showDrop).toBeFalsy(),n.labelClick(),expect(n.showDrop).toBeTruthy()})),it("should reset the selected item",inject(function(){n.selectedItem={prop:"value"},n.labelClick(),expect(n.selectedItem).toBeNull()}))})}),angular.module("liveopsConfigPanel.shared.directives").directive("loValidate",[function(){return{require:"ngModel",link:function(e,t,n,o){function i(){angular.extend(o.$disabledValidators,o.$validators),o.$validators={},angular.extend(o.$disabledFormatters,o.$formatters),o.$formatters={};for(var e in o.$disabledValidators)o.$setValidity(e,!0)}function r(){angular.extend(o.$validators,o.$disabledValidators),o.$disabledValidators={},angular.extend(o.$formatters,o.$disabledFormatters),o.$disabledFormatters={}}o.$disabledValidators={},o.$disabledFormatters={},e.$watch(n.loValidate,function(e){e?r():i()},!0)}}}]),describe("filterDropdown directive",function(){var e,t,n,o;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope",function(i,r){e=r.$new(),n=function(){t=i('<input lo-submit-spinner lo-submit-spinner-status="loading">')(e),e.$digest(),o=t.isolateScope()}}])),it("should hide the element and show the spinner when loading is true",inject(function(){e.loading=!1,n(),expect(t.hasClass("ng-hide")).toBeFalsy(),expect(o.spinnerElement.hasClass("ng-hide")).toBeTruthy()})),it("should hide the element and show the spinner when loading is true",inject(function(){e.loading=!0,n(),expect(t.hasClass("ng-hide")).toBeTruthy(),expect(o.spinnerElement.hasClass("ng-hide")).toBeFalsy()}))}),angular.module("liveopsConfigPanel.shared.directives").directive("loSubmitSpinner",[function(){return{scope:{loSubmitSpinnerStatus:"&"},link:function(e,t){e.spinnerElement=angular.element('<a disabled="true"><i class="fa fa-refresh fa-spin"></i></a>'),e.spinnerElement.addClass(t[0].className),e.spinnerElement.addClass("ng-hide"),t.after(e.spinnerElement),e.$watch("loSubmitSpinnerStatus()",function(n){angular.isDefined(n)&&(t.toggleClass("ng-hide",n),e.spinnerElement.toggleClass("ng-hide",!n))})}}}]),angular.module("liveopsConfigPanel.shared.directives").directive("loading",[function(){return{restrict:"E",templateUrl:"app/shared/directives/loading/loading.html"}}]),angular.module("liveopsConfigPanel.shared.directives").directive("modal",[function(){return{restrict:"E",templateUrl:"app/shared/directives/modal/modal.html"}}]),angular.module("liveopsConfigPanel.shared.directives").directive("ngResource",[function(){return{restrict:"A",controller:function(){}}}]),describe("ngResource directive",function(){var e,t,n;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope",function(o,i){e=i.$new(),e.ngResource={},t=o('<div ng-resource="ngResource"></div>')(e),e.$digest(),n=t.isolateScope()}])),it("should do something someday",function(){})}),angular.module("liveopsConfigPanel.shared.directives").directive("resizeHandle",["$window","$document","$rootScope","lodash",function(e,t,n,o){return{restrict:"E",scope:{leftElementId:"@",rightElementId:"@"},templateUrl:"app/shared/directives/resizeHandle/resizeHandle.html",link:function(e,i){function r(t){var n=e.leftTargetElement[0].offsetWidth,o=e.rightTargetElement[0].offsetWidth,i=e.leftTargetElement[0].getBoundingClientRect(),r=i.left,a=t.pageX;a-=r,e.resizeElements(n,o,a)}i.addClass("resize-pane"),e.leftTargetElement=angular.element($("#"+e.leftElementId)),e.rightTargetElement=angular.element($("#"+e.rightElementId)),i.on("mousedown",function(n){2!==n.button&&(n.preventDefault(),t.on("mousemove",r),t.on("mouseup",e.mouseup))}),e.resizeElements=function(t,n,o){var i=t-o,r=t-i,a=n+i,l=parseInt(e.leftTargetElement.css("min-width")),s=parseInt(e.rightTargetElement.css("min-width"));if(!(s>a||l>r)){e.leftTargetElement.css("width",r+"px"),e.rightTargetElement.css("width",a+"px");var c={leftWidth:r,rightWidth:a};e.sendResizeEvent(c),e.applyClasses(c,e.leftTargetElement,"leftWidth"),e.applyClasses(c,e.rightTargetElement,"rightWidth")}},e.sendResizeEvent=o.throttle(function(e){n.$broadcast("resizehandle:resize",e)},500),e.applyClasses=function(e,t,n){e[n]>700?t.addClass("two-col"):t.removeClass("two-col"),e[n]<450?t.addClass("compact-view"):t.removeClass("compact-view")},e.mouseup=function(){t.unbind("mousemove",r),t.unbind("mouseup",e.mouseup)}}}}]),describe("resizeHandle directive",function(){var e,t,n,o,i,r;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope","$document",function(o,i,a){e=i.$new(),t=a;var l=o('<div id="left" style="width: 300px;"></div><span id="right" style="width: 600px;"></span>')(e);angular.element(t[0].body).append(l),n=o('<resize-handle left-element-id="left" right-element-id="right" right-min-width="0" left-min-width="0"></resize-handle>')(e),e.$digest(),r=n.isolateScope()}])),it("should add div with the resizable-handle class",inject(function(){var e=n[0].querySelectorAll(".resizable-handle");expect(angular.element(e).hasClass("resizable-handle")).toBe(!0)})),it("should be call resizeElements on mousemove",inject(function(){n.triggerHandler({type:"mousedown",button:1,preventDefault:function(){}}),spyOn(n.isolateScope(),"resizeElements");var e={type:"mousemove",pageX:100};t.triggerHandler(e),expect(n.isolateScope().resizeElements).toHaveBeenCalled()})),describe("Mousedown event",function(){it("should call prevent default when mouse button isn't 2",inject(function(){var e={type:"mousedown",button:1,preventDefault:function(){}};spyOn(e,"preventDefault"),n.triggerHandler(e),expect(e.preventDefault).toHaveBeenCalled()})),it("should attach a mousemove handler when mouse button isn't 2",inject(function(){var e={type:"mousedown",button:1};spyOn(t,"on"),n.triggerHandler(e),expect(t.on).toHaveBeenCalledWith("mousemove",jasmine.any(Function))})),it("should attach a mouseup handler when mouse button isn't 2",inject(function(){var e={type:"mousedown",button:1};spyOn(t,"on"),n.triggerHandler(e),expect(t.on).toHaveBeenCalledWith("mouseup",jasmine.any(Function))})),it("shouldn't call prevent default when mouse button is 2",inject(function(){var e={type:"mousedown",button:2,preventDefault:function(){}};spyOn(e,"preventDefault"),n.triggerHandler(e),expect(e.preventDefault).not.toHaveBeenCalled()}))}),describe("resizeElements function",function(){beforeEach(function(){o=jasmine.createSpy("left css"),i=jasmine.createSpy("right css"),spyOn(r,"applyClasses"),n.isolateScope().leftTargetElement={css:o},n.isolateScope().rightTargetElement={css:i}}),it("should shrink the left element if mouseX is smaller",inject(function(){n.isolateScope().resizeElements(200,600,100),expect(o).toHaveBeenCalledWith("width","100px")})),it("should move the right element to match the left elements edge if mouseX is smaller ",inject(function(){n.isolateScope().resizeElements(200,600,100),expect(i).toHaveBeenCalledWith("width","700px")})),it("should grow the left element if mouseX is larger",inject(function(){n.isolateScope().resizeElements(200,600,500),expect(o).toHaveBeenCalledWith("width","500px")})),it("should move the right element to match the left elements edge if mouseX is larger ",inject(function(){n.isolateScope().resizeElements(200,600,500),expect(i).toHaveBeenCalledWith("width","300px")})),it("should do nothing if the new right width is less than the min width of the right element",inject(function(){n.isolateScope().rightTargetElement.css=jasmine.createSpy("css").and.returnValue("700px"),n.isolateScope().resizeElements(200,600,500),expect(i).not.toHaveBeenCalledWith("width",jasmine.any(String)),expect(o).not.toHaveBeenCalledWith("width",jasmine.any(String))})),it("should do nothing if the new left width is less than the min width of the left element",inject(function(){n.isolateScope().leftTargetElement.css=jasmine.createSpy("css").and.returnValue("700px"),n.isolateScope().resizeElements(200,600,100),expect(i).not.toHaveBeenCalledWith("width",jasmine.any(String)),expect(o).not.toHaveBeenCalledWith("width",jasmine.any(String))}))}),describe("applyClasses function",function(){it("should add the two-col class when width is larger than 700",inject(function(){var e=angular.element("<div></div>");r.applyClasses({rightWidth:800},e,"rightWidth"),expect(e.hasClass("two-col")).toBeTruthy()})),it("should remove the two-col class when width is less than or equal to 700",inject(function(){var e=angular.element("<div></div>");e.addClass("two-col"),r.applyClasses({rightWidth:700},e,"rightWidth"),expect(e.hasClass("two-col")).toBeFalsy(),e.addClass("two-col"),r.applyClasses({rightWidth:500},e,"rightWidth"),expect(e.hasClass("two-col")).toBeFalsy()})),it("should add the compact-view class when width is less than 450",inject(function(){var e=angular.element("<div></div>");r.applyClasses({rightWidth:300},e,"rightWidth"),expect(e.hasClass("compact-view")).toBeTruthy()})),it("should remove the compact-view class when width is greater than or equal to 450",inject(function(){var e=angular.element("<div></div>");e.addClass("compact-view"),r.applyClasses({rightWidth:500},e,"rightWidth"),expect(e.hasClass("compact-view")).toBeFalsy(),e.addClass("compact-view"),r.applyClasses({rightWidth:450},e,"rightWidth"),expect(e.hasClass("compact-view")).toBeFalsy()}))}),describe("mouseUp function",function(){it("should unbind the mousemove listener",inject(["$document",function(e){spyOn(e,"unbind"),r.mouseup(),expect(e.unbind).toHaveBeenCalledWith("mousemove",jasmine.any(Function))}])),it("should unbind the mouseup listener",inject(["$document",function(e){spyOn(e,"unbind"),r.mouseup(),expect(e.unbind).toHaveBeenCalledWith("mouseup",jasmine.any(Function))}]))})}),angular.module("liveopsConfigPanel.shared.directives").directive("numberSlider",["$timeout",function(e){return{restrict:"E",scope:{value:"=",minValue:"@",maxValue:"@",hasHandles:"=",placeholder:"@",ngChanged:"&"},templateUrl:"app/shared/directives/numberSlider/numberSlider.html",link:function(t,n){t.minValue=t.minValue?Number(t.minValue):null,t.maxValue=t.maxValue?Number(t.maxValue):null,t.$watch("value",function(){t.value&&("string"==typeof t.value&&(t.value=Number(t.value.replace(/[^0-9\\.\\-]/g,""))),null!==t.maxValue&&t.value>t.maxValue&&(t.value=t.maxValue),null!==t.minValue&&t.value<t.minValue&&(t.value=t.minValue),t.ngChanged(t.value))}),t.increment=function(){return t.value?((null===t.maxValue||t.value<t.maxValue)&&(t.value=Number(t.value)+1,t.ngChanged()),void 0):(t.value=t.minValue?t.minValue:0,t.ngChanged(),void 0)},t.decrement=function(){return t.value?((null===t.minValue||t.value>t.minValue)&&(t.value=Number(t.value)-1,t.ngChanged()),void 0):(t.value=t.minValue?t.minValue:0,t.ngChanged(),void 0)},n.find("input").bind("keydown keypress",function(n){40===n.which?(e(t.decrement),n.preventDefault()):38===n.which&&(e(t.increment),n.preventDefault())})}}}]),describe("numberSlider directive",function(){var e,t,n,o;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope",function(i,r){e=r.$new(),e.value=null,e.placeholder="enter a value",e.hasHandles=!0,o=function(){t=i('<number-slider value="value" placeholder="{{placeholder}}" has-handles="hasHandles"></number-slider>')(e),e.$digest(),n=t.isolateScope()}}])),it("should add an input",inject(function(){o(),expect(t.find("input").length).toEqual(1)})),it("should set min and max values to null if not defined",inject(function(){o(),expect(n.minValue).toBeNull(),expect(n.maxValue).toBeNull()})),describe("value watch",function(){it("should convert string to number",inject(function(){o(),e.value="v44",e.$digest(),expect(e.value).toEqual(44),e.value="3",e.$digest(),expect(e.value).toEqual(3),e.value="     3",e.$digest(),expect(e.value).toEqual(3)})),it("should allow negative numbers",inject(function(){o(),e.value="-3",e.$digest(),expect(e.value).toEqual(-3)})),it("should allow floating point numbers",inject(function(){o(),e.value="4.2",e.$digest(),expect(e.value).toEqual(4.2)})),it("should enforce the max value",inject(["$compile",function(o){e.maxValue=5,e.value=10,t=o('<number-slider min-value="{{minValue}}" max-value="{{maxValue}}" value="value" placeholder="{{placeholder}}" has-handles="hasHandles"></number-slider>')(e),e.$digest(),n=t.isolateScope(),expect(e.value).toEqual(5),e.value=30,e.$digest(),expect(e.value).toEqual(5)}])),it("should enforce the min value",inject(["$compile",function(o){e.minValue=0,e.value=-1,t=o('<number-slider min-value="{{minValue}}" max-value="{{maxValue}}" value="value" placeholder="{{placeholder}}" has-handles="hasHandles"></number-slider>')(e),e.$digest(),n=t.isolateScope(),expect(e.value).toEqual(0),e.value=-15,e.$digest(),expect(e.value).toEqual(0)}]))}),describe("increment function",function(){it("should increase value by 1",inject(function(){o(),n.value=1,n.increment(),expect(n.value).toEqual(2)})),it("should set value to 0 if it is null and no minvalue given",inject(function(){o(),n.value=null,n.increment(),expect(n.value).toEqual(0)})),it("should set value to minValue if value is null",inject(function(o){t=o('<number-slider min-value="-1" value="value"></number-slider>')(e),e.$digest(),n=t.isolateScope(),n.increment(),n.$digest(),expect(n.value).toEqual(-1)})),it("should not increment value if value is already maxValue",inject(function(o){t=o('<number-slider max-value="10" value="value"></number-slider>')(e),e.$digest(),n=t.isolateScope(),n.value=10,n.increment(),expect(n.value).toEqual(10)}))}),describe("decrement function",function(){it("should decrease value by 1",inject(function(){o(),n.value="1",n.decrement(),expect(n.value).toEqual(0)})),it("should set value to 0 if it is null",inject(function(){o(),n.value=null,n.decrement(),expect(n.value).toEqual(0)})),it("should set value to minValue if value is null",inject(function(o){t=o('<number-slider min-value="-1" value="value"></number-slider>')(e),e.$digest(),n=t.isolateScope(),n.decrement(),n.$digest(),expect(n.value).toEqual(-1)})),it("should not decrease value if value is already minValue",inject(function(o){t=o('<number-slider min-value="10" value="value"></number-slider>')(e),e.$digest(),n=t.isolateScope(),n.value=10,n.decrement(),expect(n.value).toEqual(10)}))}),describe("keypress event handler",function(){it("should call decrement on keydown",inject(function(e){o(),spyOn(n,"decrement");var i=jQuery.Event("keydown");i.which=40,t.find("input").trigger(i),e.flush(),expect(n.decrement).toHaveBeenCalled()})),it("should call increment on keyup",inject(function(e){o(),spyOn(n,"increment");var i=jQuery.Event("keydown");i.which=38,t.find("input").trigger(i),e.flush(),expect(n.increment).toHaveBeenCalled()}))})}),angular.module("liveopsConfigPanel.shared.directives").directive("scrollTable",[function(){return{restrict:"A",replace:"true",compile:function(e){e.removeAttr("scroll-table");var t=e.find("thead").height();0===t&&(t=35);var n=e.find("thead").clone(!0,!0);n.find("th").css("height",t+"px");var o=angular.element('<table class="clone-header">'+n[0].outerHTML+"</table>"),i=e[0].className;return o.addClass(i),e.find("thead").find("input").remove(),e.replaceWith('<div class="scrollable-table-container" style="padding-top:'+t+'px;">'+o[0].outerHTML+'<div class="table-wrapper"><div>'+e[0].outerHTML+"</div></div></div>"),function(e,n,o){o.maxHeight&&e.$watch(function(){return n.find("tbody").find("tr").length},function(e){if(e>0){var i=t*e;i<o.maxHeight?n.css("height",i+t+5+"px"):n.css("height",o.maxHeight+"px")}})}}}}]),angular.module("liveopsConfigPanel.shared.directives").directive("separateValidation",[function(){return{restrict:"A",require:"?form",link:function(e,t,n,o){if(o){var i=t.parent().controller("form");i&&i.$removeControl(o);var r={$setValidity:function(){o.$invalid=!1,angular.forEach(t.find("input"),function(e){if(o[e.name]&&o[e.name].$error)for(var t in o[e.name].$error)if(t&&o[e.name].$error[t]){o.$invalid=!0;break}})},$setDirty:function(){o.$dirty=!0},$setPristine:function(e){o.$pristine=e}};angular.extend(o,r)}}}}]),describe("separateValidation directive",function(){var e,t,n,o,i;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope",function(r,a){t=r,e=a.$new(),o=null,n=null,i=function(){n=t('<ng-form name="first-form"><input name="input-one"></input><ng-form name="inner-form" separate-validation><input name="innerInput" ng-required="true" ng-model="innerInput"></input></ng-form></ng-form>')(e),o=angular.element(n.find("ng-form")[0]).controller("form")}}])),it("should remove the subform from the parent controller",function(){var o=t('<ng-form name="first-form"><input name="input-one"></input><ng-form name="inner-form"><input name="inner-input"></input></ng-form></ng-form>')(e),i=o.controller("form");expect(i["inner-form"]).toBeDefined(),n=t('<ng-form name="first-form"><input name="input-one"></input><ng-form name="inner-form" separate-validation><input name="inner-input"></input></ng-form></ng-form>')(e);var r=n.controller("form");expect(r["inner-form"]).not.toBeDefined()}),it("should do nothing if not applied to a form",function(){n=t('<ng-form name="first-form"><input separate-validation name="input-one"></input></ng-form>')(e);var o=n.controller("form");expect(o.$addControl).not.toEqual(angular.noop),expect(o.$removeControl).not.toEqual(angular.noop)}),describe("setValidity function",function(){it("should set invalid if field is required and not supplied",function(){i(),e.$digest(),o.$setValidity(),expect(o.$invalid).toBeTruthy()}),it("should set invalid to false if field is required and supplied",function(){i(),e.$digest(),o.innerInput.$error={required:!1},o.$setValidity(),expect(o.$invalid).toBeFalsy()})}),describe("setDirty function",function(){it("should set the dirty flag to true",function(){i(),expect(o.$dirty).toBeFalsy(),o.$setDirty(),expect(o.$dirty).toBeTruthy()})}),describe("setPristine function",function(){it("should set the pristine",function(){i(),expect(o.$pristine).toBeTruthy(),o.$setPristine(!1),expect(o.$pristine).toBeFalsy(),o.$setPristine(!0),expect(o.$pristine).toBeTruthy()})})}),angular.module("liveopsConfigPanel.shared.directives").directive("singleElementResizeHandle",["$window","$document","$rootScope","lodash",function(e,t,n,o){return{restrict:"E",scope:{elementId:"@",minWidth:"@",maxWidth:"@"},templateUrl:"app/shared/directives/singleElementResizeHandle/singleElementResizeHandle.html",link:function(i,r){function a(t){var n=i.targetElement[0].offsetWidth,o=t.pageX,r=e.innerWidth;i.resizeElement(n,r,o)}i.targetElement=angular.element(document.getElementById(i.elementId)),r.on("mousedown",function(){2!==event.button&&(event.preventDefault(),t.on("mousemove",a),t.on("mouseup",i.mouseup))}),i.applyClasses=function(e,t){e>700?t.addClass("two-col"):t.removeClass("two-col"),450>e?t.addClass("compact-view"):t.removeClass("compact-view")},i.mouseup=function(){t.unbind("mousemove",a),t.unbind("mouseup",i.mouseup)},i.sendResizeEvent=o.throttle(function(e){n.$broadcast("resizehandle:resize",e)},500),i.resizeElement=function(e,t,n){var o=t-n;o<i.minWidth||o>i.maxWidth||(i.targetElement.css("width",o+"px"),i.sendResizeEvent(o),i.applyClasses(o,i.targetElement))}}}}]),angular.module("liveopsConfigPanel.shared.directives").directive("tableCell",[function(){return{scope:{item:"=",name:"@"},link:function(e,t,n,o,i){var r=e.$new();i(r,function(n){t.empty(),angular.forEach(n,function(n){n.attributes&&n.attributes.name&&n.attributes.name.value===e.name&&t.append(n)}),t.on("$destroy",function(){r.$destroy()})})}}}]),angular.module("liveopsConfigPanel.shared.directives").directive("tableControls",["$rootScope","$filter","$location","$stateParams","$parse","DirtyForms","Session",function(e,t,n,o,i,r,a){return{restrict:"E",scope:{id:"@",config:"=",items:"=",selected:"=",extendScope:"=",resourceName:"@"},templateUrl:"app/shared/directives/tableControls/tableControls.html",transclude:!0,controller:function(){},link:function(l){l.primaryKey=l.config.primaryKey?l.config.primaryKey:"id",l.$watch("config",function(){l.showBulkActions=angular.isDefined(l.config.showBulkActions)?l.config.showBulkActions:!0,l.showCreate=angular.isDefined(l.config.showCreate)?l.config.showCreate:!0,l.reverseSortOrder=!1,l.orderBy=l.config.orderBy}),angular.extend(l,l.extendScope),l.$on("created:resource:"+l.resourceName,function(e,t){l.selected=t,n.search({id:t.id})}),l.$on("dropdown:item:checked",function(){var e=a.columnPreferences;e[l.config.title]=l.config.fields,a.setColumnPreferences(e)}),l.onCreateClick=function(){r.confirmIfDirty(function(){e.$broadcast("table:on:click:create")})},l.onActionsClick=function(){r.confirmIfDirty(function(){l.selected=void 0,e.$broadcast("table:on:click:actions")})},l.selectItem=function(t){r.confirmIfDirty(function(){l.selected=t,t&&n.search({id:t.id}),e.$broadcast("table:resource:selected",t)})},l.checkItem=function(t,n){var o=angular.isDefined(n)?n:!t.checked;t.checked!==o&&(t.checked=o,e.$broadcast("table:resource:checked",t))},l.parse=function(e,t){if(t.resolve)return t.resolve(e);if(t.name){var n=i(t.name);return n(e)}},l.toggleAll=function(e){angular.forEach(l.filtered,function(t){l.checkItem(t,e)})},l.items&&l.items.$promise.then(function(){if(0===l.items.length)e.$broadcast("resource:create");else if(o.id){var n=t("filter")(l.items,{id:o.id},!0);if(n.length>0)return l.selectItem(n[0]),void 0;l.selected=l.selectItem(null)}}),l.$watchCollection("filtered",function(){if(!l.items||!l.items.$resolved)return l.selectItem(null),void 0;if(0===l.filtered.length)return e.$broadcast("resource:create"),void 0;var n=!1;if(l.selected){var o=t("filter")(l.filtered,{id:l.selected.id},!0);o.length>0&&(n=!0)}n||l.selectItem(null),angular.forEach(l.items,function(e){e.checked&&l.filtered.indexOf(e)<0&&(e.checked=!1)})}),l.sortTable=function(e){var t;e.sortOn?t=e.sortOn:e.name&&(t=e.name),l.reverseSortOrder=t===l.orderBy?!l.reverseSortOrder:!1,l.orderBy=t},l.clearAllFilters=function(){l.searchQuery=null,angular.forEach(l.config.fields,function(e){if(e.header.options){var n=t("invoke")(e.header.options);angular.forEach(n,function(e){e.checked=!1})}})},l.getFields=function(){for(var e=0;e<l.config.fields.length;e++)if(a.columnPreferences[l.config.title])for(var t=0;t<a.columnPreferences[l.config.title].length;t++){var n=a.columnPreferences[l.config.title][t];l.config.fields[e].header.display===n.header.display&&(l.config.fields[e].checked=angular.isUndefined(n.checked)?!0:n.checked)}return l.config.fields}}}}]),describe("tableControls directive",function(){var e,t,n,o,i;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope","$stateParams",function(r,a,l){e=a.$new(),t=l,e.config={fields:[{name:"id"}],searchOn:["id"]},e.selected={},e.resourceName="resource",e.extendScope={},e.id="my-table",e.items=[],e.items.$promise={then:function(e){e()}},e.items.$resolved=!0,i=function(){n=r('<table-controls items="items" config="config" selected="selected" resource-name="{{resourceName}}" extend-scope="extendScope" id="id"></table-controls>')(e),e.$digest(),o=n.isolateScope()}}])),it("should create a table",inject(function(){i(),expect(n.find("table").length).toEqual(2)})),it("should add extendscope to its own scope",inject(function(){e.extendScope={newProperty:"neat"},i(),expect(o.newProperty).toBeDefined(),expect(o.newProperty).toEqual("neat")})),it("should select item based on url param",inject(function(){e.items.push({id:"item1"}),e.items.push({id:"item2"}),t.id="item2",i(),expect(e.selected).toEqual(e.items[1])})),it("should not try to select item based on url param if no items",inject(function(){var t=spyOn(e.items.$promise,"then");delete e.items,i(),expect(t).not.toHaveBeenCalled()})),it("should not select an item if id in url params does not match any item",inject(function(){e.items.push({id:"item1"}),e.items.push({id:"item2"}),t.id="somethingelse",i(),expect(e.selected).toEqual(null)})),it("should select nothing on init if there is no id param",inject(function(){delete t.id,e.selected=null,e.items.push({id:"item1"}),e.items.push({id:"item2"}),i(),expect(e.selected).toEqual(null)})),it("should not display columns that are unchecked in config",inject(function(){e.config.fields.push({name:"color",checked:!1}),e.config.fields.push({name:"online",checked:!0}),i(),expect(n.find("th").length).toBe(6)})),it("should include a filter dropdown if field config has options defined",inject(function(){e.config.fields.push({name:"color",header:{options:[{display:"Disabled",value:"disabled"},{display:"Enabled",value:"enabled"},{display:"Pending",value:"pending"}]}}),i(),expect(n.find("table").find("filter-dropdown").length).toBe(2)})),it("should catch the created:resource event and select the newly created item",inject(["$rootScope",function(e){i();var t={id:"myNewItem"};e.$broadcast("created:resource:resource",t),o.$digest(),expect(o.selected).toEqual(t)}])),describe("selectItem function",function(){beforeEach(function(){i()}),it("should be defined",inject(function(){expect(o.selectItem).toBeDefined(),expect(o.selectItem).toEqual(jasmine.any(Function))})),it("should check DirtyForms.confirmIfDirty",inject(["DirtyForms",function(e){spyOn(e,"confirmIfDirty"),o.selectItem(),expect(e.confirmIfDirty).toHaveBeenCalled()}])),it("should set selected",inject(function(){o.selectItem({name:"my new item"}),e.$digest(),expect(e.selected.name).toEqual("my new item")})),it("should call location to update the query param",inject(["$location",function(e){spyOn(e,"search"),o.selectItem({id:"id1"}),expect(e.search).toHaveBeenCalledWith({id:"id1"}),e.search.calls.reset(),o.selectItem(),expect(e.search).not.toHaveBeenCalled(),e.search.calls.reset(),o.selectItem({something:"blah"}),expect(e.search).toHaveBeenCalledWith({id:void 0})}])),it("should emit the resource:selected event",inject(["$rootScope",function(e){spyOn(e,"$broadcast"),o.selectItem({name:"my item"}),expect(e.$broadcast).toHaveBeenCalledWith("table:resource:selected",{name:"my item"})
}]))}),describe("onCreateClick function",function(){beforeEach(function(){i()}),it("should be defined",inject(function(){expect(o.onCreateClick).toBeDefined(),expect(o.onCreateClick).toEqual(jasmine.any(Function))})),it("should check DirtyForms.confirmIfDirty",inject(["DirtyForms",function(e){spyOn(e,"confirmIfDirty"),o.onCreateClick(),expect(e.confirmIfDirty).toHaveBeenCalled()}])),it("should emit the table create click event",inject(["$rootScope",function(e){spyOn(e,"$broadcast"),o.onCreateClick(),expect(e.$broadcast).toHaveBeenCalledWith("table:on:click:create")}]))}),describe("onActionsClick function",function(){beforeEach(function(){i()}),it("should be defined",inject(function(){expect(o.onActionsClick).toBeDefined(),expect(o.onActionsClick).toEqual(jasmine.any(Function))})),it("should check DirtyForms.confirmIfDirty",inject(["DirtyForms",function(e){spyOn(e,"confirmIfDirty"),o.onActionsClick(),expect(e.confirmIfDirty).toHaveBeenCalled()}])),it("should emit the table actions click event",inject(["$rootScope",function(e){spyOn(e,"$broadcast"),o.onActionsClick(),expect(e.$broadcast).toHaveBeenCalledWith("table:on:click:actions")}]))}),describe("toggleAll function",function(){beforeEach(function(){e.items.push({id:"item1",checked:!1}),e.items.push({id:"item2",checked:!0}),e.items.push({id:"item3"}),i()}),it("should set all filtered items to checked when param is true",inject(function(){o.toggleAll(!0),expect(e.items[0].checked).toBeTruthy(),expect(e.items[1].checked).toBeTruthy(),expect(e.items[2].checked).toBeTruthy()})),it("should set all filtered items to unchecked when param is false",inject(function(){o.toggleAll(!1),expect(e.items[0].checked).toBeFalsy(),expect(e.items[1].checked).toBeFalsy(),expect(e.items[2].checked).toBeFalsy()})),it("should only apply to filtered items",inject(function(){o.filtered.removeItem(e.items[2]),o.toggleAll(!0),expect(e.items[0].checked).toBeTruthy(),expect(e.items[1].checked).toBeTruthy(),expect(e.items[2].checked).toBeFalsy()}))}),describe("filtered",function(){beforeEach(function(){e.items.push({id:"item1",checked:!1}),e.items.push({id:"item2",checked:!0}),e.items.push({id:"item3"}),i()}),it("should update when searchQuery changes",inject(function(){o.searchQuery="item2",o.$digest(),expect(o.filtered.length).toBe(1),expect(o.filtered[0].id).toEqual("item2")})),it("watch should set selected item to null if there isn't one",inject(function(){spyOn(o,"selectItem"),delete o.selected,o.searchQuery="item1",o.$digest(),expect(o.selectItem).toHaveBeenCalledWith(null)})),it("watch should reset selected item if old one gets filtered",inject(function(){spyOn(o,"selectItem"),o.selected=e.items[2],o.searchQuery="item1",o.$digest(),expect(o.selectItem).toHaveBeenCalledWith(null)})),it("watch should uncheck items that have been filtered out",inject(function(){o.searchQuery="item3",o.$digest(),expect(e.items[1].checked).toBeFalsy()}))}),describe("parse function",function(){beforeEach(function(){i()}),it("should exist",inject(function(){expect(o.parse).toBeDefined(),expect(o.parse).toEqual(jasmine.any(Function))})),it("should call and return field.name if field.name is a function",inject(function(){var e={entity:"the Hypnotoad"},t={name:function(e){return"All Glory to "+e.entity}},n=o.parse(e,t);expect(n).toEqual("All Glory to the Hypnotoad")})),it("should return the field value if field.name is a string",inject(function(){var e={bob:"yes"},t={name:"bob"},n=o.parse(e,t);expect(n).toEqual("yes")})),it("should do nothing if field name is a type other than string or function",inject(function(){var e,t,n={bob:"yes"};t={name:!1},e=o.parse(n,t),expect(e).toBeUndefined(),t={name:[]},e=o.parse(n,t),expect(e).toBeUndefined(),t={name:{}},e=o.parse(n,t),expect(e).toBeUndefined(),t={name:11},e=o.parse(n,t),expect(e).toBeUndefined()})),it("should call resolve function if it is defined",inject(function(){var e={bob:"yes"},t={resolve:jasmine.createSpy("resolve").and.returnValue("spyResult")},n=o.parse(e,t);expect(t.resolve).toHaveBeenCalledWith(e),expect(n).toEqual("spyResult")}))}),describe("sortTable function",function(){beforeEach(function(){i()}),it("should exist",inject(function(){expect(o.sortTable).toBeDefined(),expect(o.sortTable).toEqual(jasmine.any(Function))})),it("should toggle reverseSortOrder if the orderBy field is already the given field",inject(function(){o.reverseSortOrder=!0,o.orderBy="theField",o.sortTable({name:"theField"}),expect(o.reverseSortOrder).toBeFalsy()})),it("should toggle reverseSortOrder if the orderBy field is already the given field's sortOn value",inject(function(){o.reverseSortOrder=!0,o.orderBy="theField",o.sortTable({sortOn:"theField"}),expect(o.reverseSortOrder).toBeFalsy()})),it("should set orderBy and reset reverseSortOrder if it is a newly chosen field",inject(function(){o.reverseSortOrder=!0,o.orderBy="anotherField",o.sortTable({name:"theField"}),expect(o.reverseSortOrder).toBeFalsy(),expect(o.orderBy).toEqual("theField")})),it("should set orderBy to the field's sortOn value and reset reverseSortOrder if it is a newly chosen field",inject(function(){o.reverseSortOrder=!0,o.orderBy="anotherField",o.sortTable({sortOn:"theField"}),expect(o.reverseSortOrder).toBeFalsy(),expect(o.orderBy).toEqual("theField")}))}),describe("clearAllFilters function",function(){beforeEach(function(){i(),e.config.fields=[{header:{id:"one"}},{header:{id:"two"}}]}),it("should exist",inject(function(){expect(o.clearAllFilters).toBeDefined(),expect(o.clearAllFilters).toEqual(jasmine.any(Function))})),it("should clear the search field",inject(function(){o.clearAllFilters(),expect(o.searchQuery).toBeNull()})),it("should deselect all filters, if provided",inject(function(){o.config.fields[0].header.options=[{id:"option1",checked:!0},{id:"option2"},{id:"option3",checked:!1}],o.clearAllFilters(),expect(o.config.fields[0].header.options[0].checked).toBeFalsy(),expect(o.config.fields[0].header.options[1].checked).toBeFalsy(),expect(o.config.fields[0].header.options[2].checked).toBeFalsy()}))})}),angular.module("liveopsConfigPanel.shared.directives").directive("confirmToggle",["Modal","$timeout",function(e,t){return{require:["ngModel","^toggle"],link:function(n,o,i,r){r[0].$parsers.push(function(e){return n.onToggle(e)}),n.onToggle=function(o){return t(function(){n.$parent.ngModel=o===n.trueValue?n.falseValue:n.trueValue}),e.showConfirm({message:o===n.trueValue?n.confirmEnableMessage:n.confirmDisableMessage}).then(function(){n.$parent.ngModel=o})}}}}]),describe("confirmToggleDirective",function(){var e,t,n;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope","$q",function(o,i,r){n=r,e=i.$new(),e.model=!1,e.bool=!1,t=o('<toggle confirm-toggle ng-model="model" confirm-enable-message="Are you sure?" confirm-disable-message="Really sure"?></toggle>')(e),e.$digest()}])),describe("onToggle function",function(){it("should show a confirm modal if toggled to false",inject(["Modal",function(t){e.confirmEnableMessage="Show the thing",e.confirmDisableMessage="Do not do the thing",spyOn(t,"showConfirm").and.callFake(function(){var e=n.defer();return e.resolve("true"),e.promise}),e.onToggle(!1),expect(t.showConfirm).toHaveBeenCalled()}])),it("should show a confirm modal if toggled to true",inject(["Modal",function(t){e.confirmEnableMessage="Show the thing",e.confirmDisableMessage="Do not do the thing",spyOn(t,"showConfirm").and.callFake(function(){var e=n.defer();return e.resolve("true"),e.promise}),e.onToggle(!0),expect(t.showConfirm).toHaveBeenCalled()}])),it("should toggle ngModel as false if user clicks ok on the modal",inject(["Modal",function(t){e.confirmEnableMessage="Show the thing",e.confirmDisableMessage="Do not do the thing";var o=n.defer();o.resolve("true"),spyOn(t,"showConfirm").and.returnValue(o.promise),e.ngModel=!1,e.onToggle(!1),expect(e.ngModel).toBeFalsy()}])),it("should leave ngModel to true if user clicks cancel on the modal",inject(["Modal","$timeout",function(t,o){e.confirmEnableMessage="Show the thing",e.confirmDisableMessage="Do not do the thing",spyOn(t,"showConfirm").and.callFake(function(){var e=n.defer();return e.reject("false"),e.promise}),e.falseValue=!1,e.trueValue=!0,e.ngModel=!1,e.onToggle(!1),o.flush(),expect(e.$parent.ngModel).toBeTruthy()}]))})}),angular.module("liveopsConfigPanel.shared.directives").directive("toggle",[function(){return{templateUrl:"app/shared/directives/toggle/toggle.html",scope:{ngModel:"=",ngDisabled:"=",name:"@",trueValue:"@",falseValue:"@",confirmEnableMessage:"@",confirmDisableMessage:"@"},controller:function(e){angular.isUndefined(e.trueValue)&&(e.trueValue=!0),angular.isUndefined(e.falseValue)&&(e.falseValue=!1),angular.isDefined(e.confirmEnableMessage)&&angular.isDefined(e.confirmDisableMessage)&&(e.confirmOnToggle=!0)}}}]),describe("toggleDirective",function(){var e,t,n;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope",function(o,i){e=i.$new(),e.model=!1,e.bool=!1,t=o('<toggle ng-model="model" ng-disabled="bool"></toggle>')(e),e.$digest(),n=t.isolateScope()}])),it("should do something",function(){expect(n.ngModel).toBe(e.model),expect(n.ngDisabled).toBe(e.bool)}),it("should set a default falseValue and trueValue if none are given",function(){expect(n.falseValue).toEqual(!1),expect(n.trueValue).toEqual(!0)}),it("should set a default falseValue and trueValue if none are given",function(){expect(n.falseValue).toEqual(!1),expect(n.trueValue).toEqual(!0)})}),angular.module("liveopsConfigPanel.shared.directives").directive("tooltip",["$document","$timeout",function(e,t){return{templateUrl:"app/shared/directives/tooltip/tooltip.html",scope:{text:"@",target:"=",translateValue:"@"},link:function(n,o){n.targetPosition=n.target.offset(),n.tooltipWidth=0,n.tooltipHeight=0,n.setPosition=function(){o.find("div").removeClass("top left right bottom"),n.tooltipWidth=o.outerWidth(),n.tooltipHeight=o.outerHeight();var e=n.getPositionClass(),t=n.getAbsolutePosition(e);o.find("div").addClass(e),o.css("left",t.left),o.css("top",t.top)},n.getPositionClass=function(){var t,o=e.width(),i=e.height(),r=n.targetPosition.top,a=n.targetPosition.left;return t=r-n.tooltipHeight<0?a-n.tooltipWidth<0?"bottom right":a+n.tooltipWidth>o?"bottom left":"bottom center":r+n.tooltipHeight>i?a-n.tooltipWidth<0?"top right":a+n.tooltipWidth>o?"top left":"top center":a-n.tooltipWidth<0?"center right":a+n.tooltipWidth>o?"center left":"top center"},n.getAbsolutePosition=function(e){var t=15,o=13,i=25,r=n.target.outerHeight(),a=n.target.outerWidth(),l=n.targetPosition.left,s=n.targetPosition.top;return e.indexOf("left")>-1&&(l+=-n.tooltipWidth-o),e.indexOf("right")>-1&&(l+=a+o),"bottom center"===e?(s+=r+t,l+=-((n.tooltipWidth-a)/2)):"top center"===e?(s+=-(n.tooltipHeight+t),l+=-((n.tooltipWidth-a)/2)):"top right"===e||"top left"===e?s+=-n.tooltipHeight+i:("center right"===e||"center left"===e)&&(s+=-(n.tooltipHeight/2)+r/2),{top:s,left:l}},t(n.setPosition,1)}}}]),describe("tooltip directive",function(){var e,t,n,o,i;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope","$document","$timeout",function(r,a,l,s){e=a.$new(),n=r,i=l;var c=jasmine.createSpy("offset").and.returnValue({left:0,top:0}),u=jasmine.createSpy("height").and.returnValue(10),d=jasmine.createSpy("width").and.returnValue(15);e.myItem={offset:c,outerHeight:u,outerWidth:d},o=n('<tooltip text="my tooltip text" target="myItem"></tooltip>')(e),e.$digest(),s.flush(),t=o.isolateScope()}])),it("should render the text",inject(function(){expect(o.text()).toEqual("my tooltip text")})),describe("getPositionClass function",function(){beforeEach(function(){spyOn(i,"width").and.returnValue(100),spyOn(i,"height").and.returnValue(100),t.tooltipHeight=20,t.tooltipWidth=20}),it('should return "bottom right" if element is near top left corner of document',inject(function(){t.targetPosition.top=0,t.targetPosition.left=0,expect(t.getPositionClass()).toEqual("bottom right"),t.targetPosition.top=10,t.targetPosition.left=10,expect(t.getPositionClass()).toEqual("bottom right")})),it('should return "bottom left" if element is near top right corner of document',inject(function(){t.targetPosition.top=0,t.targetPosition.left=100,expect(t.getPositionClass()).toEqual("bottom left"),t.targetPosition.top=10,t.targetPosition.left=90,expect(t.getPositionClass()).toEqual("bottom left")})),it('should return "bottom center" if element is near top of the document and not near a side',inject(function(){t.targetPosition.top=0,t.targetPosition.left=50,expect(t.getPositionClass()).toEqual("bottom center"),t.targetPosition.top=10,t.targetPosition.left=50,expect(t.getPositionClass()).toEqual("bottom center")})),it('should return "top right" if element is near bottom left of the document',inject(function(){t.targetPosition.top=100,t.targetPosition.left=0,expect(t.getPositionClass()).toEqual("top right"),t.targetPosition.top=90,t.targetPosition.left=10,expect(t.getPositionClass()).toEqual("top right")})),it('should return "top left" if element is near bottom right of the document',inject(function(){t.targetPosition.top=100,t.targetPosition.left=100,expect(t.getPositionClass()).toEqual("top left"),t.targetPosition.top=90,t.targetPosition.left=90,expect(t.getPositionClass()).toEqual("top left")})),it('should return "top center" if element is near bottom of the document and not near a side',inject(function(){t.targetPosition.top=100,t.targetPosition.left=50,expect(t.getPositionClass()).toEqual("top center"),t.targetPosition.top=90,t.targetPosition.left=50,expect(t.getPositionClass()).toEqual("top center")})),it('should return "center right" if element is near the left of the document but not near top or bottom',inject(function(){t.targetPosition.top=50,t.targetPosition.left=0,expect(t.getPositionClass()).toEqual("center right"),t.targetPosition.top=50,t.targetPosition.left=10,expect(t.getPositionClass()).toEqual("center right")})),it('should return "center left" if element is near the right of the document but not near top or bottom',inject(function(){t.targetPosition.top=50,t.targetPosition.left=100,expect(t.getPositionClass()).toEqual("center left"),t.targetPosition.top=50,t.targetPosition.left=90,expect(t.getPositionClass()).toEqual("center left")})),it('should return "top center" if element is not near any edge',inject(function(){t.targetPosition.top=50,t.targetPosition.left=50,expect(t.getPositionClass()).toEqual("top center"),t.targetPosition.top=40,t.targetPosition.left=70,expect(t.getPositionClass()).toEqual("top center")}))}),describe("getAbsolutePosition function",function(){var e=15,n=13,o=25,i=10,r=15,a=20,l=30;beforeEach(function(){t.tooltipHeight=a,t.tooltipWidth=l,t.targetPosition.top=50,t.targetPosition.left=50}),it('should return coordinates to the bottom right of target when given "bottom right"',inject(function(){var e=t.getAbsolutePosition("bottom right");expect(e.top).toEqual(50),expect(e.left).toEqual(50+r+n)})),it('should return coordinates to the bottom left of target when given "bottom left"',inject(function(){var e=t.getAbsolutePosition("bottom left");expect(e.top).toEqual(50),expect(e.left).toEqual(50-l-n)})),it('should return coordinates to the bottom center of target when given "bottom center"',inject(function(){var n=t.getAbsolutePosition("bottom center");expect(n.top).toEqual(50+i+e);var o=57.5,r=15;expect(n.left).toEqual(o-r)})),it('should return coordinates to the top right of target when given "top right"',inject(function(){var e=t.getAbsolutePosition("top right");expect(e.top).toEqual(50-a+o),expect(e.left).toEqual(50+r+n)})),it('should return coordinates to the top left of target when given "top left"',inject(function(){var e=t.getAbsolutePosition("top left");expect(e.top).toEqual(50-a+o),expect(e.left).toEqual(50-l-n)})),it('should return coordinates to the top center of target when given "top center"',inject(function(){var n=t.getAbsolutePosition("top center");expect(n.top).toEqual(50-(a+e));var o=57.5,i=15;expect(n.left).toEqual(o-i)})),it('should return coordinates to the right of target when given "center right"',inject(function(){var e=t.getAbsolutePosition("center right"),o=55,i=10;expect(e.top).toEqual(o-i),expect(e.left).toEqual(50+r+n)})),it('should return coordinates to the right of target when given "center left"',inject(function(){var e=t.getAbsolutePosition("center left"),o=55,i=10;expect(e.top).toEqual(o-i),expect(e.left).toEqual(50-(l+n))})),it("should return the target elements coordinates when given an unsupported value",inject(function(){var e=t.getAbsolutePosition("center center");expect(e.top).toEqual(50),expect(e.left).toEqual(50),e=t.getAbsolutePosition("foo"),expect(e.top).toEqual(50),expect(e.left).toEqual(50)}))})}),angular.module("liveopsConfigPanel.shared.directives").directive("typeAhead",["$filter","$timeout",function(e,t){return{restrict:"E",scope:{items:"=",nameField:"@",onSelect:"&",placeholder:"@",prefill:"=",keepExpanded:"=",onEnter:"&",filters:"=?",selectedItem:"="},templateUrl:"app/shared/directives/typeAhead/typeAhead.html",controller:function(t){var n=this;t.currentText=t.prefill||"",this.defaultTextFilter=function(e,t){return e.getDisplay().toLowerCase().contains(t.toLowerCase())},t.filterCriteria=function(e){if(t.filterArray){for(var n=!0,o=0;o<t.filterArray.length;o++){var i=t.filterArray[o];n=n&&i.call(i,e,t.currentText,t.items)}return n}},t.$watch("filters",function(e){t.filterArray=[],e&&angular.isArray(e)?t.filterArray=angular.copy(e):e&&!angular.isArray(e)&&(t.filterArray=[e]),t.filterArray.push(n.defaultTextFilter)},!0),t.updateHighlight=function(){var n=e("filter")(t.items,t.filterCriteria,!0);if(""===t.currentText)t.highlightedItem=null,t.selectedItem=null;else if(n&&n.length>0){var o=n.indexOf(t.highlightedItem);0>o&&(t.highlightedItem=null,t.selectedItem=t.currentText),angular.isDefined(n[0].getDisplay)&&n[0].getDisplay()===t.currentText?(t.highlightedItem=n[0],t.selectedItem=n[0]):(t.highlightedItem=n[0],t.selectedItem=t.currentText)}else t.highlightedItem=null,t.selectedItem=t.currentText},t.$watch("currentText",function(){t.updateHighlight()}),t.$watch("selectedItem",function(e){null===e&&(t.currentText="")}),t.$watch("items",function(e){angular.isDefined(e)&&t.updateHighlight()},!0),t.select=function(e){angular.isString(e)||(t.currentText=angular.isDefined(e.getDisplay)?e.getDisplay():e[t.nameField]),t.selectedItem=e,t.onSelect({selectedItem:e}),t.keepExpanded||(t.hovering=!1,t.showSuggestions=!1)},t.onBlur=function(){t.keepExpanded||(t.showSuggestions=!1)},t.orderByFunction=function(e){var n=e.getDisplay();return n?n:e[t.nameField]}},link:function(e,n){n.find("input").bind("keydown keypress",function(o){var i;13===o.which?(t(function(){var t=e.highlightedItem?e.highlightedItem:e.currentText;e.select(t),e.onEnter({item:t})}),o.preventDefault()):40===o.which?(i=e.filtered.indexOf(e.highlightedItem),i+1<e.filtered.length&&t(function(){e.highlightedItem=e.filtered[i+1];var t=n.find("li:nth-child("+(i+2)+")");e.showListElement(t)})):38===o.which&&(i=e.filtered.indexOf(e.highlightedItem),i-1>=0&&t(function(){e.highlightedItem=e.filtered[i-1];var t=n.find("li:nth-child("+i+")");e.showListElement(t)}))}),e.showListElement=function(e){var t=e.get(0).offsetTop,o=e.get(0).offsetHeight,i=t+o,r=n.find("ul").get(0).offsetHeight,a=n.find("ul").get(0).scrollTop;i>a+r?n.find("ul").get(0).scrollTop=i-r:a>t&&(n.find("ul").get(0).scrollTop=t)}}}}]),describe("typeAhead directive",function(){var e,t,n,o,i,r;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope","$timeout",function(a,l,s){t=a,e=l.$new(),r=s,e.items=[{title:"firstItem",extraProp:"true",getDisplay:jasmine.createSpy("getDisplay").and.returnValue("firstItem")},{title:"secondItem",getDisplay:jasmine.createSpy("getDisplay").and.returnValue("secondItem")},{title:"secondItemAgain",getDisplay:jasmine.createSpy("getDisplay").and.returnValue("secondItemAgain")},{title:"thirdItem",getDisplay:jasmine.createSpy("getDisplay").and.returnValue("thirdItem")}],e.selectedItem={id:"2"},e.selectFunction=function(){},i=function(){n=t('<type-ahead items="items" name-field="title" selected-item="selected" on-select="selectFunction()" is-required="required" placeholder="Type here" hover="hover"></type-ahead>')(e),e.$digest(),o=n.isolateScope()}}])),it("should set text to empty if the selected item changes to null",function(){i(),e.selectedItem=null,e.$digest(),expect(o.currentText).toEqual("")}),it("should set item to null if there is no text",function(){i(),e.currentText="",e.$digest(),expect(o.selectedItem).toBeNull()}),it("should set item to null if there is only whitespace",function(){i(),e.currentText="                 ",e.$digest(),expect(o.selectedItem).toBeNull()}),it("should do nothing if selected item changes to an object",function(){i(),o.currentText="some text",e.selectedItem={id:"5"},e.$digest(),expect(o.currentText).toEqual("some text")}),describe("currentText watch",function(){it("should set selectedItem to the search string if currentText has no matches",function(){i(),o.currentText="typing some stuff",o.$digest(),expect(o.selectedItem).toEqual("typing some stuff")}),it("should set selectedItem to the first exact matching item",function(){i(),o.currentText="firstItem",o.$digest(),expect(angular.equals(o.selectedItem,{title:"firstItem",extraProp:"true"})).toBeTruthy()})}),describe("select function",function(){it("should set the selected item",function(){i(),o.select({title:"new item"}),expect(o.selectedItem).toEqual({title:"new item"})}),it("should clear hovering",function(){i(),o.select({title:"new item"}),expect(o.hovering).toEqual(!1)}),it("should set the current text to the proper field value is getDisplay is not defined on the selected item",function(){i(),o.select({title:"new item",anotherProp:"Blah"}),expect(o.currentText).toEqual("new item")})}),describe("ON filters watch",function(){var i;describe("WHEN filters, nameField not supplied",function(){beforeEach(function(){n=t('<type-ahead items="items" selected-item="selected"></type-ahead>')(e),e.$digest(),o=n.isolateScope(),i=n.data("$typeAheadController")}),it("should have only the defaultTextFilter in fitlerArray WHEN no filters or nameField are given",function(){expect(o.filterArray).toBeDefined(),expect(o.filterArray.length).toEqual(1),expect(o.filterArray[0]).toBe(i.defaultTextFilter)})}),describe("WHEN filters supplied and is a function",function(){var r=function(){};beforeEach(function(){e.filters=r}),it("should create array with $scope.filters and defaultTextFilter in fitlerArray",function(){n=t('<type-ahead items="items" selected-item="selected" filters="filters"></type-ahead>')(e),e.$digest(),o=n.isolateScope(),i=n.data("$typeAheadController"),expect(o.filterArray).toBeDefined(),expect(o.filterArray.length).toEqual(2),expect(o.filterArray.indexOf(r)).not.toEqual(-1),expect(o.filterArray.indexOf(i.defaultTextFilter)).not.toEqual(-1),expect(o.filterArray.indexOf(i.nameFieldTextFilter)).toEqual(-1)})}),describe("WHEN filters is supplied is and array",function(){var r=function(){},a=function(){};beforeEach(function(){e.filters=[r,a]}),it("should create array with $scope.filters merged with defaultTextFilter in fitlerArray",function(){n=t('<type-ahead items="items" selected-item="selected" filters="filters"></type-ahead>')(e),e.$digest(),o=n.isolateScope(),i=n.data("$typeAheadController"),expect(o.filterArray).toBeDefined(),expect(o.filterArray.length).toEqual(3),expect(o.filterArray.indexOf(r)).not.toEqual(-1),expect(o.filterArray.indexOf(a)).not.toEqual(-1),expect(o.filterArray.indexOf(i.defaultTextFilter)).not.toEqual(-1),expect(o.filterArray.indexOf(i.nameFieldTextFilter)).toEqual(-1)})})}),describe("keypress event handler",function(){it("should call select with highlightedItem on pressing the enter key",inject(function(e){i(),spyOn(o,"select");var t={id:"highlight"};o.highlightedItem=t;var r=jQuery.Event("keydown");r.which=13,n.find("input").trigger(r),e.flush(),expect(o.select).toHaveBeenCalledWith(t)})),it("should call select with currenttext on pressing the enter key if nothing is highlighted",inject(function(e){i(),spyOn(o,"select"),o.currentText="some text";var t=jQuery.Event("keydown");t.which=13,n.find("input").trigger(t),e.flush(),expect(o.select).toHaveBeenCalledWith("some text")})),it("should call onEnter with the highlighted item on pressing the enter key",inject(function(e){i(),spyOn(o,"select"),spyOn(o,"onEnter");var t={id:"highlight"};o.highlightedItem=t;var r=jQuery.Event("keydown");r.which=13,n.find("input").trigger(r),e.flush(),expect(o.onEnter).toHaveBeenCalledWith({item:t})})),it("should call onEnter with the current text on pressing the enter key if nothing is selected",inject(function(e){i(),spyOn(o,"select"),spyOn(o,"onEnter"),o.currentText="some text";var t=jQuery.Event("keydown");t.which=13,n.find("input").trigger(t),e.flush(),expect(o.onEnter).toHaveBeenCalledWith({item:"some text"})})),it("should highlight the next item on down arrow key, if there are more items",inject(function(t){i(),o.highlightedItem=e.items[0];var r=jQuery.Event("keydown");r.which=40,n.find("input").trigger(r),t.flush(),expect(o.highlightedItem).toEqual(e.items[1])})),it("should do nothing on down arrow if the current highlight is the last",inject(function(t){i(),o.highlightedItem=e.items[3];var r=jQuery.Event("keydown");r.which=40,n.find("input").trigger(r),t.flush(),expect(o.highlightedItem).toEqual(e.items[3])})),it("should highlight the previous item on up arrow key, if there are any",inject(function(t){i(),o.highlightedItem=e.items[3];var r=jQuery.Event("keydown");r.which=38,n.find("input").trigger(r),t.flush(),expect(o.highlightedItem).toEqual(e.items[2])})),it("should do nothing on up arrow if the current highlight is the first",inject(function(t){i(),o.highlightedItem=e.items[0];var r=jQuery.Event("keydown");r.which=38,n.find("input").trigger(r),t.flush(),expect(o.highlightedItem).toEqual(e.items[0])}))}),describe("onBlur function",function(){it("should set showSuggestions to false",inject(function(){i(),o.showSuggestions=!0,o.keepExpanded=!1,o.onBlur(),expect(o.showSuggestions).toBeFalsy()})),it("should do nothing if keeyExpanded is true",inject(function(){i(),o.showSuggestions=!0,o.keepExpanded=!0,o.onBlur(),expect(o.showSuggestions).toBeTruthy()}))})}),angular.module("liveopsConfigPanel.shared.directives").directive("uuid",[function(){return{restrict:"A",require:"ngModel",link:function(e,t,n,o){o.$validators.uuid=function(e,t){return o.$isEmpty(e)?!0:/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)?!0:!1}}}}]),describe("uuidValidator directive",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.directives.mock.content")),beforeEach(inject(["$compile","$rootScope",function(n,o){e=o.$new(),t=n('<input type="text" uuid ng-model="mymodel"/>')(e),e.$digest()}])),it("should set a uuid validator on the ngModel controller",inject(function(){expect(t.controller("ngModel").$validators.uuid).toBeDefined()})),it("should consider an empty model to be valid",inject(function(){expect(t.controller("ngModel").$validators.uuid()).toBeTruthy()})),it("should return true if the view value is a valid UUID format",inject(function(){expect(t.controller("ngModel").$validators.uuid("457f4900-b017-45ea-b306-b2c9f3527439","457f4900-b017-45ea-b306-b2c9f3527439")).toBeTruthy(),expect(t.controller("ngModel").$validators.uuid("00000000-0000-1000-a000-000000000000","00000000-0000-1000-a000-000000000000")).toBeTruthy(),expect(t.controller("ngModel").$validators.uuid("AAAAAAAA-AAAA-1AAA-AAAA-AAAAAAAAAAAA","AAAAAAAA-AAAA-1AAA-AAAA-AAAAAAAAAAAA")).toBeTruthy(),expect(t.controller("ngModel").$validators.uuid("aaaaaaaa-aaaa-1aaa-aaaa-aaaaaaaaaaaa","aaaaaaaa-aaaa-1aaa-aaaa-aaaaaaaaaaaa")).toBeTruthy()})),it("should return false if the view value is not a valid UUID format",inject(function(){expect(t.controller("ngModel").$validators.uuid("457f4900-b017-45ea-b306-b2c9f3527439","")).toBeFalsy(),expect(t.controller("ngModel").$validators.uuid("457f4900-b017-45ea-b306-b2c9f3527439","some stuff")).toBeFalsy(),expect(t.controller("ngModel").$validators.uuid("457f4900-b017-45ea-b306-b2c9f3527439","AAAAAAAAAAAA1AAAAAAAAAAAAAAAAAAA")).toBeFalsy(),expect(t.controller("ngModel").$validators.uuid("457f4900-b017-45ea-b306-b2c9f3527439","1234567")).toBeFalsy()}))}),angular.module("liveopsConfigPanel.shared.directives").directive("unsavedChangesWarning",["DirtyForms","$rootScope","$window","Alert","$translate",function(e,t,n,o,i){return{restrict:"A",require:"?form",link:function(r,a,l,s){s&&(r.destroyStateListener=t.$on("$stateChangeStart",function(e){s.$dirty&&o.confirm(i.instant("unsavedchanges.nav.warning"),angular.noop,function(){e.preventDefault()})}),n.onbeforeunload=function(){return s.$dirty?i.instant("unsavedchanges.reload.warning"):void 0},e.registerForm(s),r.$on("$destroy",function(){e.removeForm(s),r.destroyStateListener()}))}}}]),describe("unsavedChangesWarning directive",function(){var e,t,n;beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope",function(o,i){e=i.$new(),n=function(){t=o('<ng-form name="detailsForm" unsaved-changes-warning></ng-form>')(e),e.$digest()}}])),it("should register the form with the DirtyForms service",inject(["DirtyForms",function(e){spyOn(e,"registerForm"),n(),expect(e.registerForm).toHaveBeenCalled()}])),it("should do nothing if there is no form controller",inject(["DirtyForms","$compile",function(n,o){spyOn(n,"registerForm"),t=o("<div unsaved-changes-warning></div>")(e),e.$digest(),expect(n.registerForm).not.toHaveBeenCalled()}])),it("should unregister the form from the DirtyForms service when destroyed",inject(["DirtyForms",function(t){n();var o=spyOn(t,"removeForm");e.$destroy(),expect(o).toHaveBeenCalled()}])),it("should unregister the state listener when destroyed",inject([function(){n();var t=spyOn(e,"destroyStateListener");e.$destroy(),expect(t).toHaveBeenCalled()}])),describe("$stateChangeStart handler",function(){beforeEach(function(){n()}),it("should popup a confirm alert if the form is dirty",inject(["Alert","$state","$rootScope",function(t,n,o){spyOn(t,"confirm"),e.detailsForm.$dirty=!0,o.$broadcast("$stateChangeStart",{next:{isPublic:!0}}),expect(t.confirm).toHaveBeenCalled()}])),it("should do nothing and allow the state change to happen on ok",inject(["Alert","$state","$rootScope",function(t,n,o){spyOn(t,"confirm").and.callFake(function(e,t){t()}),spyOn(angular,"noop"),e.detailsForm.$dirty=!0,o.$broadcast("$stateChangeStart",{next:{isPublic:!0}}),expect(angular.noop).toHaveBeenCalled()}])),it("should prevent the event on cancel",inject(["Alert","$state","$rootScope",function(t,n,o){spyOn(t,"confirm").and.callFake(function(e,t,n){n()}),e.detailsForm.$dirty=!0;var i=o.$broadcast("$stateChangeStart",{next:{isPublic:!0}});expect(i.defaultPrevented).toBeTruthy()}])),it("should do nothing if the form is not dirty",inject(["Alert","$state","$rootScope",function(t,n,o){spyOn(t,"confirm"),e.detailsForm.$dirty=!1,o.$broadcast("$stateChangeStart",{next:{isPublic:!0}}),expect(t.confirm).not.toHaveBeenCalled()}]))}),describe("onbeforeunload function",function(){beforeEach(function(){n()}),it("should set $window.onbeforeunload",inject(["$window",function(e){expect(e.onbeforeunload).toBeDefined(),expect(e.onbeforeunload).toEqual(jasmine.any(Function))}])),it("should set a message if the form is dirty",inject(["$window",function(t){e.detailsForm.$dirty=!0,expect(t.onbeforeunload()).toEqual(jasmine.any(String))
}])),it("should do nothing if the form isn't dirty",inject(["$window",function(t){e.detailsForm.$dirty=!1,expect(t.onbeforeunload()).toBeUndefined()}]))})}),angular.module("liveopsConfigPanel.shared.filters").filter("hasPermission",["UserPermissions",function(e){return function(t){return angular.isArray(t)||(t=[t]),e.hasPermissionInList(t)}}]),angular.module("liveopsConfigPanel.shared.filters").filter("keysCount",[function(){return function(e){return Object.keys(e).length}}]),describe("keysCount filter",function(){var e;beforeEach(module("liveopsConfigPanel.shared.filters")),beforeEach(module("gulpAngular")),beforeEach(inject(["$filter",function(t){e=t("keysCount")}])),it("should return the number of properties on the object",inject(function(){var t=e({});expect(t).toBe(0),t=e({one:1,two:!0,three:"3",four:[4]}),expect(t).toBe(4)}))}),angular.module("liveopsConfigPanel.shared.filters").filter("matchesField",["$filter",function(e){return function(t,n,o){var i=function(t,n,o){if(!(angular.isUndefined(t)||angular.isUndefined(n)||""===n||angular.isUndefined(o))){var r=n.indexOf(":");if(r>-1){var a=n.substring(0,r),l=n.substring(r+1);return i(t[a],l,o)?t:void 0}if(angular.isArray(t)){for(var s=0;s<t.length;s++)if(t[s][n]===o)return t}else if(e("parse")(t,n)===o)return t}};return i(t,n,o)}}]),describe("matchesField filter",function(){var e;beforeEach(module("liveopsConfigPanel.shared.filters")),beforeEach(module("gulpAngular")),beforeEach(inject(["$filter",function(t){e=t("matchesField")}])),it("should return undefined if missing paramaters",inject(function(){var t=e();expect(t).toBeUndefined(),t=e([]),expect(t).toBeUndefined(),t=e([],"field"),expect(t).toBeUndefined(),t=e([],"",!0),expect(t).toBeUndefined()})),it("should return given item if there is a first-level match",inject(function(){var t={field:"a neat value",name:"Sally"},n=e(t,"name","Sally");expect(n).toBe(t)})),it("should return undefined if there isn't a first-level match",inject(function(){var t={field:"a neat value",name:"Sally"},n=e(t,"name","Markus");expect(n).toBeUndefined()})),it("should return given item if there is a nested match",inject(function(){var t={field:"a neat value",owner:{name:"Sally"}},n=e(t,"owner:name","Sally");expect(n).toBe(t)})),it("should return undefined if there isn't a nested match",inject(function(){var t={field:"a neat value",owner:{name:"Sally"}},n=e(t,"owner:name","Markus");expect(n).toBeUndefined()})),it("should return given item if there is a deeply nested match",inject(function(){var t={owner:{contact:{city:{name:"fredericton"}}}},n=e(t,"owner:contact:city:name","fredericton");expect(n).toBe(t)})),it("should return undefined if there isn't a deeply nested match",inject(function(){var t={owner:{contact:{city:{name:"fredericton"}}}},n=e(t,"owner:contact:city:name","moncton");expect(n).toBeUndefined()})),it("should return undefined if the given item doesn't have the nested field",inject(function(){var t={owner:{contact:"1234567"}},n=e(t,"owner:contact:city:name","moncton");expect(n).toBeUndefined()})),it("should return the item if the field matches an array value",inject(function(){var t={things:[{id:"id1"},{id:"id2"}]},n=e(t,"things:id","id2");expect(n).toBe(t)})),it("should return undefined if there is no match in an array value",inject(function(){var t={things:[{id:"id1"},{id:"id2"}]},n=e(t,"things:id","some other string");expect(n).toBeUndefined()}))}),angular.module("liveopsConfigPanel.shared.filters").filter("objectNegation",function(){return function(e,t,n,o){var i=[];return angular.forEach(e,function(e){for(var r=!0,a=0;a<n.length;a++){var l=n[a];if(e[t]===l[o]){r=!1;break}}r&&i.push(e)}),i}}),angular.module("liveopsConfigPanel.shared.filters").filter("invoke",[function(){return function(e,t){return angular.isFunction(e)?e.call(t):e}}]),angular.module("liveopsConfigPanel.shared.filters").filter("parse",["$parse",function(e){return function(t,n){return e(n)(t)}}]),angular.module("liveopsConfigPanel.shared.filters").filter("search",["$parse",function(e){return function(t,n,o){function i(e){return e.replace(/([.+?^=!:${}()|\[\]\/\\])/g,"\\$1"),e.replace(/([*])/g,".*")}if(!n||!o)return t;var r=function(t,n){var o=[],i=e(t.path),a=i(n);return"string"==typeof a?o=[a]:"object"==typeof a&&angular.forEach(i(n),function(e){o="inner"in t?o.concat(r(t.inner,e)):[e]}),o},a=[];return angular.forEach(t,function(t){var l=new RegExp(i(o),"i"),s="";angular.forEach(n,function(n){"string"==typeof n?s+=e(n)(t)+" ":"object"==typeof n&&(s+=r(n,t).join(" ")+" ")}),l.test(s)&&a.push(t)}),a}}]),describe("search filter",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.filters")),beforeEach(module("gulpAngular")),beforeEach(inject(["$filter",function(n){t=[{id:"3",status:!1,state:"WRAP",lastName:"Wazowski",firstName:"Mike",email:"mike.Wazowski@hivedom.org",skills:[{name:"walking"},{name:"talking"}],test:{array:[{fieldName:"fieldValue"}]},text_array:["text1","text2"],recur1:[{recur2:[{recur3:[{name:"youdidit!"}]}]}]}],e=n("search")}])),it("should return all items if search is blank",inject(function(){var n=e(t,["firstName","lastName"],"");expect(n.length).toBe(1)})),it("should return all items if fields are blank",inject(function(){var n=e(t,null,"ssssss");expect(n.length).toBe(1)})),it("should not return item if search not included in item's values",inject(function(){var n=e(t,["firstName","lastName"],"blahh");expect(n.length).toBe(0)})),it("should return item if search is included in first given field",inject(function(){var n=e(t,["firstName","lastName"],"ike");expect(n.length).toBe(1)})),it("should return item if search is included in multiple given fields",inject(function(){var n=e(t,["firstName","lastName"],"Mike Wazowski");expect(n.length).toBe(1)})),it("should return item if search is included in last given field",inject(function(){var n=e(t,["firstName","lastName"],"ski");expect(n.length).toBe(1)})),it("should not return if only part search is included in item fields",inject(function(){var n=e(t,["firstName","lastName"],"Michael Wazowski");expect(n.length).toBe(0)})),it("should return item if search has wildcard value only",inject(function(){var n=e(t,["firstName","lastName"],"*");expect(n.length).toBe(1)})),it("should return item with containing partial string using wildcard in query",inject(function(){var n=e(t,["firstName","lastName"],"Mi*Wazowski");expect(n.length).toBe(1)})),it("should only return item containing partial strings using several wildcards in query",inject(function(){var n=e(t,["firstName","lastName"],"i*e*a");expect(n.length).toBe(1),n=e(t,["firstName","lastName"],"i*l*e*a"),expect(n.length).toBe(0)})),it("should return matching item regardless of character case",inject(function(){var n=e(t,["firstName","lastName"],"MIKE wAzoWsKi");expect(n.length).toBe(1)})),it("should not return item when search string does not match any fields",inject(function(){var n=e(t,["firstName","lastName"],"Randall Boggs");expect(n.length).toBe(0)})),it("should not return item when search string with wild cards does not match any fields",inject(function(){var n=e(t,["firstName","lastName"],"*boo*");expect(n.length).toBe(0)})),it("should not use the asterisk as a repeat operator",inject(function(){var n=e(t,["firstName","lastName"],"q*");expect(n.length).toBe(0)})),it("should use the asterisk as 0 or more of any valid character",inject(function(){var n=e(t,["firstName","lastName"],"M*i*W*a*z*o*i");expect(n.length).toBe(1)})),it("should return the same result regardless of wildcard repeats",inject(function(){var n=e(t,["firstName","lastName"],"M*****");expect(n.length).toBe(1)})),it("should return the same result for strings starting and ending with wildcard",inject(function(){var n=e(t,["firstName","lastName"],"*Wazow*");expect(n.length).toBe(1),n=e(t,["firstName","lastName"],"*Wazow*"),expect(n.length).toBe(1),n=e(t,["firstName","lastName"],"Wazow"),expect(n.length).toBe(1),n=e(t,["firstName","lastName"],"Wazow*"),expect(n.length).toBe(1),n=e(t,["firstName","lastName"],"*Wazow"),expect(n.length).toBe(1)})),it("should return nothing if fields aren't object or strings",inject(function(){var n=e(t,[5,!0],"W");expect(n.length).toBe(0)})),it("should return results when skills match",inject(function(){var n=e(t,[{path:"skills",inner:{path:"name"}}],"walk");expect(n.length).toBe(1)})),it("should return results when skills match",inject(function(){var n=e(t,[{path:"skills",inner:{path:"name"}}],"walk");expect(n.length).toBe(1)})),it("should return results when inner attribute matches",inject(function(){var n=e(t,[{path:"test.array",inner:{path:"fieldName"}}],"Value");expect(n.length).toBe(1)})),it("should not return results when path is incorrect",inject(function(){var n=e(t,[{path:"test.array_z",inner:{path:"fieldName"}}],"Value");expect(n.length).toBe(0)})),it("should return when query in text array",inject(function(){var n=e(t,[{path:"text_array"}],"text");expect(n.length).toBe(1)})),it("should not return when query not in text array",inject(function(){var n=e(t,[{path:"text_array"}],"text3");expect(n.length).toBe(0)})),it("should return even with 3x recursion",inject(function(){var n=e(t,[{path:"recur1",inner:{path:"recur2",inner:{path:"recur3",inner:{path:"name"}}}}],"youdidit!");expect(n.length).toBe(1)})),it("should not return even with 3x recursion because of wrong path",inject(function(){var n=e(t,[{path:"recur1",inner:{path:"recur3",inner:{path:"recur2",inner:{path:"name"}}}}],"youdidit!");expect(n.length).toBe(0)})),describe("on multiple items",function(){beforeEach(function(){t=[{id:"3",status:"true",state:"WRAP",lastName:"Wazowski",firstName:"Mike",email:"mike.Wazowski@hivedom.org",skills:[{name:"talking"}]},{id:"7",status:!0,state:"OFFLINE",lastName:"Walter",firstName:"Serge",email:"serge.walter@example.com",skills:[{name:"walking"}]}]}),it("should return multiple results if they match",inject(function(){var n=e(t,["firstName","lastName"],"w");expect(n.length).toBe(2)})),it("should only return matching results",inject(function(){var n=e(t,["firstName","lastName"],"se");expect(n.length).toBe(1),expect(n[0]).toEqual(t[1])})),it("should return results matching string and primitive fields",inject(function(){var n=e(t,["status"],"tru");expect(n.length).toBe(2)})),it("should return one walking users",inject(function(){var n=e(t,[{path:"skills",inner:{path:"name"}}],"walking");expect(n.length).toBe(1)})),it("should return one talking users",inject(function(){var n=e(t,[{path:"skills",inner:{path:"name"}}],"talking");expect(n.length).toBe(1)})),it("should return two king users",inject(function(){var n=e(t,[{path:"skills",inner:{path:"name"}}],"king");expect(n.length).toBe(2)}))})}),angular.module("liveopsConfigPanel.shared.filters").filter("selectedOptions",["$filter",function(e){return function(t,n){var o=[],i=e("invoke")(n.options);return angular.forEach(t,function(t){var r=!1;angular.forEach(i,function(i){var a=e("invoke")(i.value,i);!r&&i.checked&&e("matchesField")(t,n.name,a)&&(o.push(t),r=!0)})}),o}}]),describe("selectedOptions filter",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.filters")),beforeEach(inject(["$filter","$rootScope",function(n){e=n,t=[{status:!1,state:"WRAP",value:4},{status:!0,state:"NOT_READY",value:5},{status:!0,state:"READY",value:6},{status:!0,state:"WRAP",value:4}]}])),it("should return all users if the all values are checked",inject(function(){var n={name:"status",options:[{value:!1,checked:!0},{value:!0,checked:!0}]},o=e("selectedOptions")(t,n);expect(o.length).toEqual(t.length)})),it("should return users that match one selected filter",inject(function(){var n={name:"status",options:[{value:!1,checked:!0},{value:!0,checked:!1}]},o=e("selectedOptions")(t,n);expect(o.length).toEqual(1)})),it("should return users that match one of many selected filters",inject(function(){var n={name:"state",options:[{value:"WRAP",checked:!0},{value:"READY",checked:!1},{value:"NOT_READY",checked:!0}]},o=e("selectedOptions")(t,n);expect(o.length).toEqual(3)})),it("should return an empty array if no users match the filters",inject(function(){var n={name:"state",options:[{value:"SOMETHINGELSE",checked:!0},{value:"READY",checked:!1}]},o=e("selectedOptions")(t,n);expect(o.length).toEqual(0)})),it("should work with string and primitive values in the field",inject(function(){var n={name:"status",options:[{value:!0,checked:!0},{value:!1,checked:!1}]},o=e("selectedOptions")(t,n);expect(o.length).toEqual(3)}))}),angular.module("liveopsConfigPanel.shared.filters").filter("selectedTableOptions",["$parse","$filter",function(e,t){return function(n,o){var i=[];if(angular.isUndefined(n))return i;for(var r=!0,a=0;a<n.length;a++){for(var l=n[a],s=!0,c=0;c<o.length;c++){var u=!0,d=o[c];if(e("header.options")(d)){for(var f=d.lookup?d.lookup:d.name,h=t("invoke")(d.header.options),p=0;p<h.length;p++){var m=h[p];if(r=r&&!m.checked,m.checked){var g=e(d.header.valuePath?d.header.valuePath:"value"),v=t("invoke")(g(m),m);if(t("matchesField")(l,f,v)){u=!0;break}u=!1}}s=s&&u}}s&&i.push(l)}return r?n:i}}]),describe("selectedTableOptions filter",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.filters")),beforeEach(inject(["$filter","$rootScope",function(n){e=n,t=[{status:!1,state:"WRAP",value:4},{status:!0,state:"NOT_READY",value:5},{status:!0,state:"READY",value:6},{status:!0,state:"WRAP",value:4}]}])),it("should return all users if the all values are checked",inject(function(){var n=[{name:"status",header:{options:[{value:!1,checked:!0},{value:!0,checked:!1}]}}],o=e("selectedTableOptions")(t,n);expect(o.length).toEqual(1)}))}),angular.module("liveopsConfigPanel.shared.services").service("Alert",["toastr","$window",function(e,t){this.confirm=function(e,n,o){t.confirm(e)?n&&n():o&&o()},this.warning=function(){e.warning.apply(this,arguments)},this.success=function(){e.success.apply(this,arguments)},this.error=function(){e.error.apply(this,arguments)},this.info=function(){e.info.apply(this,arguments)}}]),describe("Alert service",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.services")),beforeEach(inject(["Alert","toastr",function(n,o){e=n,t=o}])),describe("error function",function(){it("should call toastr error",inject(function(){spyOn(t,"error"),e.error("message1","message2"),expect(t.error).toHaveBeenCalledWith("message1","message2")}))}),describe("success function",function(){it("should call toastr success",inject(function(){spyOn(t,"success"),e.success("message"),expect(t.success).toHaveBeenCalledWith("message")}))}),describe("warning function",function(){it("should call toastr warning",inject(function(){spyOn(t,"warning"),e.warning("message"),expect(t.warning).toHaveBeenCalledWith("message")}))}),describe("confirm function",function(){it("should pop up a window alert",inject(["$window",function(t){spyOn(t,"confirm"),e.confirm("message"),expect(t.confirm).toHaveBeenCalledWith("message")}])),it("should call onOk callback",inject(["$window",function(t){spyOn(t,"confirm").and.callFake(function(){return!0});var n=jasmine.createSpy("ok");e.confirm("message",n),expect(n).toHaveBeenCalled()}])),it("should call onCancel callback",inject(["$window",function(t){spyOn(t,"confirm").and.callFake(function(){return!1});var n=jasmine.createSpy("cancel");e.confirm("message",angular.noop,n),expect(n).toHaveBeenCalled()}]))})}),angular.module("liveopsConfigPanel.shared.services").service("cacheAddInterceptor",["queryCache",function(e){this.response=function(t){var n=Object.getPrototypeOf(t.resource),o=t.resource.cacheKey?t.resource.cacheKey():n.resourceName;return e.get(o)||e.put(o,[]),e.get(o).push(t.resource),t.resource}}]),angular.module("liveopsConfigPanel.shared.services").service("cacheRemoveInterceptor",["queryCache",function(e){this.response=function(t){var n=Object.getPrototypeOf(t.resource),o=t.resource.cacheKey?t.resource.cacheKey():n.resourceName;return e.get(o)&&e.get(o).removeItem(t.resource),t.resource}}]),describe("cacheRemoveInterceptor service",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.services")),beforeEach(inject(["cacheRemoveInterceptor","$rootScope",function(n,o){e=n,t=o}])),describe("response function",function(){it("should remove the resource from the stored array in the cache",inject(["queryCache",function(t){var n=function(e){this.id=e};n.prototype.resourceName="myResource";var o=new n("myid"),i=[{id:"1"},{id:2},o];spyOn(t,"get").and.returnValue(i),e.response({resource:o}),expect(i.length).toBe(2)}])),it("should do nothing if there is no cached array",inject(["queryCache",function(t){var n=function(e){this.id=e};n.prototype.resourceName="myResource";var o=new n("myid");spyOn(t,"get");var i={resource:o},r=e.response(i);expect(r).toBe(o)}]))})}),angular.module("liveopsConfigPanel.shared.services").service("emitInterceptor",["$rootScope","$q","$location","Session","apiHostname",function(e,t,n,o,i){this.response=function(t){var n=t.config.url.replace(i+"/v1",""),o=n.replace(/\//g,":"),r=Object.getPrototypeOf(t.resource);return 201===t.status?(e.$broadcast("created:resource:"+r.resourceName,t.resource),e.$broadcast("created:resource"+o,t.resource)):200===t.status&&(o=o.replace(/:[-\w]+$/,""),e.$broadcast("updated:resource:"+r.resourceName,t.resource),e.$broadcast("updated:resource"+o,t.resource)),t.resource}}]),describe("emitInterceptor service",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.services")),beforeEach(inject(["emitInterceptor","$rootScope",function(n,o){e=n,t=o}])),describe("response function",function(){it("should broadcast created resource on 201 status",inject(function(){spyOn(t,"$broadcast"),e.response({config:{url:"/test"},status:201,resource:{}}),expect(t.$broadcast).toHaveBeenCalledWith("created:resource:test",{})})),it("should broadcast updated resource on 200 status",inject(function(){spyOn(t,"$broadcast"),e.response({config:{url:"/test/123"},status:200,resource:{}}),expect(t.$broadcast).toHaveBeenCalledWith("updated:resource:test",{})})),it("should do nothing on a status other than 200 and 201",inject(function(){spyOn(t,"$broadcast"),e.response({config:{url:"/test"},status:205,resource:{}}),expect(t.$broadcast).not.toHaveBeenCalled()}))})}),angular.module("liveopsConfigPanel.shared.services").factory("LiveopsResourceFactory",["$http","$resource","$q","apiHostname","Session","queryCache","lodash",function(e,t,n,o,i,r,a){function l(e){return e.result?e.result:e}function s(e,t){return a.startsWith(e,"$")?void 0:t}function c(e){if(angular.isArray(e)){var t=function(t){return angular.forEach(e,function(e){e.response(t)}),t.resource},n={response:t};return n}return e}function u(e,t){return a.startsWith(e,"$")?void 0:t}return{create:function(n){function i(e){var t=angular.copy(e);return angular.forEach(t,function(e,o){var i=a.findIndex(n.updateFields,{name:o});(0>i||null===e&&n.updateFields[i].optional)&&delete t[o]}),t}function d(e){var t=i(e);return JSON.stringify(t,u)}function f(e){return JSON.stringify(e,s)}n.requestUrlFields=angular.isDefined(n.requestUrlFields)?n.requestUrlFields:{id:"@id",tenantId:"@tenantId",groupId:"@groupId",flowId:"@flowId",queueId:"@queueId",userId:"@userId",memberId:"@memberId"};var h=Array.prototype.concat(e.defaults.transformResponse,l),p=n.getRequestTransformer,m=n.getResponseTransformer?Array.prototype.concat(n.getResponseTransformer,h):h,g=n.queryRequestTransformer,v=n.queryResponseTransformer?Array.prototype.concat(n.queryResponseTransformer,h):h,y=n.putRequestTransformer?Array.prototype.concat(n.putRequestTransformer,d):d,b=n.putResponseTransformer?Array.prototype.concat(n.putRequestTransformer,h):h,x=n.postRequestTransformer?Array.prototype.concat(n.postRequestTransformer,f):f,$=n.postResponseTransformer?Array.prototype.concat(n.postResponseTransformer,h):h,E=n.deleteRequestTransformer,k=n.deleteResponseTransformer?Array.prototype.concat(n.deleteResponseTransformer,h):h,w={"Content-Type":"application/json"},C=t(o+n.endpoint,n.requestUrlFields,{query:{method:"GET",isArray:!0,headers:w,transformRequest:g,transformResponse:v,interceptor:c(n.queryInterceptor)},get:{method:"GET",headers:w,transformRequest:p,transformResponse:m,interceptor:c(n.getInterceptor)},update:{method:"PUT",headers:w,transformRequest:y,transformResponse:b,interceptor:c(n.updateInterceptor)},save:{method:"POST",headers:w,transformRequest:x,transformResponse:$,interceptor:c(n.saveInterceptor)},"delete":{method:"DELETE",headers:w,transformRequest:E,transformResponse:k,interceptor:c(n.saveInterceptor)}});C.prototype.resourceName=n.resourceName,C.prototype.$$backupSudoProperties=function(){var e={};return angular.forEach(this,function(t,n){n.match(/^\$[^$].*/g)&&!angular.isFunction(t)&&["$original","$busy","$resolved"].indexOf(n)<0&&(e[n]=t)}),e},C.prototype.$$restoreSudoProperties=function(e,t){angular.forEach(t,function(t,n){e[n]?angular.isObject(t)&&angular.extend(e[n],t):e[n]=t})};var j=C.get;C.get=function(e,t,n){var o=j.call(this,e,t,n);return o.$promise.then(function(e){return e.$original=angular.copy(e),e}),o};var B=C.query;C.query=function(e,t,n){var o=B.call(this,e,t,n);return o.$promise.then(function(e){return angular.forEach(e,function(e){e.$original=angular.copy(e)}),e}),o};var S=C.prototype.$save;C.prototype.$save=function(e,t,n){var o=S.call(this,e,t,n);return o.then(function(e){return e.$original=angular.copy(e),e}),o};var A=C.prototype.$update;return C.prototype.$update=function(e,t,n){var o=A.call(this,e,t,n);return o.then(function(e){return e.$original=angular.copy(e),e}),o},C.cachedGet=function(e,t,n){var o=t?t:this.prototype.resourceName,i=r.get(o);(!i||n)&&(r.put(o,[]),i=r.get(o));var l=a.find(i,e);if(!l){l=this.get(e);for(var s in e)l[s]=e[s];i.push(l)}return l},C.cachedQuery=function(e,t,n){var o=t?t:this.prototype.resourceName;if(!r.get(o)||n){var i=this.query(e);return r.put(o,i),i}return r.get(o)},C.prototype.save=function(e,t,n){var o=this,i=this.isNew()?this.$save:this.$update;o.$busy=!0;var r=this.$$backupSudoProperties();return i.call(o,e,t,n).then(function(e){return o.$original=angular.copy(e),o.$original&&o.$original.$original&&delete o.$original.$original,o.$$restoreSudoProperties(e,r),e}).finally(function(){o.$busy=!1})},C.prototype.reset=function(){for(var e in this.$original)e.match(/^\$.*/g)||angular.isFunction(this.$original[e])||(this[e]=angular.copy(this.$original[e]))},C.prototype.getDisplay=function(){return this.toString()},C.prototype.isNew=function(){return!(this.hasOwnProperty("created")||angular.isDefined(this.id))},C.prototype.$busy=!1,C}}}]),describe("LiveopsResourceFactory",function(){describe("ON reset",function(){var e;beforeEach(module("liveopsConfigPanel.shared.services")),beforeEach(inject(["LiveopsResourceFactory",function(t){e=t.create({endpoint:"/endpoint"})}])),it("should reset object back to $original",function(){var t=new e;t.$original={id:"abc"},t.id="123",t.reset(),expect(t.id).toEqual("abc")}),it("should ignore $ members",function(){var t=new e;t.$original={$id:"abc"},t.$id="123",t.reset(),expect(t.$id).toEqual("123")})}),describe("queryCache function",function(){var e,t,n;beforeEach(module("gulpAngular")),beforeEach(module("liveopsConfigPanel.shared.services")),beforeEach(module("liveopsConfigPanel.shared.services.mock.content.management.skills")),beforeEach(inject(["LiveopsResourceFactory","$httpBackend","apiHostname",function(o,i,r){t=o.create({endpoint:"/endpoint"}),n=i,e=r}])),describe("$original copy",function(){it("should store a pristine copy of all objects returned on query",function(){n.whenGET(e+"/endpoint").respond(200,[{id:"1"},{id:"2"}]);var o=t.query();n.flush(),expect(o[0].$original.id).toEqual("1"),expect(o[1].$original.id).toEqual("2")}),it("should store a pristine copy of the object returned on get",function(){n.expectGET(e+"/endpoint").respond(200,{id:"1"});var o=t.get();n.flush(),expect(o.$original.id).toEqual("1")}),it("should have a function to reset an object back to its original state",function(){n.expectGET(e+"/endpoint").respond(200,{id:"1"});var o=t.get();n.flush(),o.id="abc",o.reset(),expect(o.id).toEqual("1")})}),describe("ON cachedQuery",function(){beforeEach(inject([function(){spyOn(t,"query").and.returnValue([])}])),it("should return api data on first call",inject(["queryCache",function(e){var n=t.cachedQuery({},"key");expect(n.length).toEqual(0),expect(e.get("key")).toBe(n)}])),it("should return cached data on second call",inject(["queryCache",function(e){var n=t.cachedQuery({},"key");expect(n.length).toEqual(0),t.query=jasmine.createSpy().and.returnValue([{id:"id1"}]),n=t.cachedQuery({},"key"),expect(n.length).not.toEqual(1),expect(e.get("key")).toBe(n)}])),it("should return api data when invalidate is true",inject(["queryCache",function(e){var n=t.cachedQuery({},"key");expect(n.length).toEqual(0),expect(e.get("key")).toBe(n),t.query=jasmine.createSpy().and.returnValue([{id:"id1"}]),n=t.cachedQuery({},"key",!0),expect(n.length).toEqual(1),expect(n[0].id).toEqual("id1"),expect(e.get("key")).toBe(n)}]))})}),describe("USING mock $resource",function(){var e,t,n,o,i,r,a;beforeEach(module("liveopsConfigPanel.shared.services",function(e){t=jasmine.createSpy("ResourceMock").and.callFake(function(e,t,n){function o(){this.$save=r,this.$update=i}return a=n,r=jasmine.createSpy("$save"),i=jasmine.createSpy("$update"),o}),e.value("$resource",t)})),beforeEach(inject(["apiHostname","LiveopsResourceFactory",function(e,t){n=e,o=t}])),it("should call the $resource constructor",inject(function(){e=o.create({endpoint:"/endpoint"}),expect(t).toHaveBeenCalledWith(n+"/endpoint",jasmine.any(Object),{query:jasmine.any(Object),get:jasmine.any(Object),update:jasmine.any(Object),save:jasmine.any(Object),"delete":jasmine.any(Object)})})),it("should use given requestUrlFields if defined",inject(function(){e=o.create({endpoint:"/endpoint",requestUrlFields:{title:"@title"}}),expect(t).toHaveBeenCalledWith(n+"/endpoint",{title:"@title"},{query:jasmine.any(Object),get:jasmine.any(Object),update:jasmine.any(Object),save:jasmine.any(Object),"delete":jasmine.any(Object)})})),describe("update config",function(){describe("transformRequest function",function(){it("should return empty object when not given any updatefields",inject([function(){o.create({endpoint:"/endpoint"});var e=a.update.transformRequest,t=e({someProp:"someValue",anotherProp:"anotherValue"});expect(t).toEqual("{}")}])),it("should only return fields given by updatefields",inject([function(){o.create({endpoint:"/endpoint",updateFields:[{name:"myfield"},{name:"coolfield"}]});var e=a.update.transformRequest,t=e({myfield:"someValue",coolfield:"thats cool",uncool:"not cool at all"});expect(t).toEqual('{"myfield":"someValue","coolfield":"thats cool"}')}])),it("should not include null data if its optional",inject([function(){o.create({endpoint:"/endpoint",updateFields:[{name:"myfield",optional:!0}]});var e=a.update.transformRequest,t=e({myfield:null});expect(t).toEqual("{}")}])),it("should include null data if its not optional",inject([function(){o.create({endpoint:"/endpoint",updateFields:[{name:"myfield",optional:!1}]});var e=a.update.transformRequest,t=e({myfield:null});expect(t).toEqual('{"myfield":null}')}]))}),describe("transformResponse",function(){it("should append a function to the transformResponse array to return data from the result object",inject([function(){o.create({endpoint:"/endpoint"});var e=a.update.transformResponse[a.update.transformResponse.length-1],t=e({result:{someProp:"somevalue"}});expect(t).toEqual({someProp:"somevalue"}),t=e({someProp:"somevalue"}),expect(t).toEqual({someProp:"somevalue"}),t=e([]),expect(t).toEqual([])}]))})}),describe("query config",function(){it("should set isArray to true",inject([function(){o.create({endpoint:"/endpoint"}),expect(a.query.isArray).toBeTruthy()}]))}),describe("prototype save function",function(){it("should call $update if the object exists",inject(["$q",function(t){e=o.create({endpoint:"/endpoint"});var n=new e;n.id="id1",n.$update=i.and.returnValue(t.when({})),n.save(),expect(i).toHaveBeenCalled()}])),it("should call $save if the object if new",inject(["$q",function(t){e=o.create({endpoint:"/endpoint"});var n=new e;n.$save=r.and.returnValue(t.when({})),n.save(),expect(r).toHaveBeenCalled()}]))})})}),angular.module("liveopsConfigPanel.shared.services").factory("queryCache",["$cacheFactory",function(e){return e("queryCache")}]),angular.module("liveopsConfigPanel.shared.services").service("Modal",["$document","$rootScope","$compile","$q",function(e,t,n,o){var i=this;this.showConfirm=function(r){var a={title:"",message:"",okCallback:angular.noop,cancelCallback:angular.noop},l=o.defer(),s=angular.extend(a,r),c=t.$new();c.modalBody="app/shared/services/modal/confirmModal.html",c.title=s.title,c.message=s.message,c.okCallback=function(){i.close(),l.resolve("true"),s.okCallback()},c.cancelCallback=function(){i.close(),l.reject("false"),s.cancelCallback()};var u=n("<modal></modal>")(c);return e.find("body").append(u),l.promise},this.close=function(){e.find("modal").remove()}}]),describe("Modal service",function(){var e;beforeEach(module("liveopsConfigPanel.shared.services")),beforeEach(inject(["Modal",function(t){e=t}])),describe("close function",function(){it("should remove all modal elements from the document",inject(["$document",function(t){var n=jasmine.createSpy("remove"),o=spyOn(t,"find").and.returnValue({remove:n});e.close(),expect(o).toHaveBeenCalledWith("modal"),expect(n).toHaveBeenCalled()}]))}),describe("showConfirm function",function(){it("should add a modal element with defaults",inject(["$document",function(t){var n=jasmine.createSpy("append"),o=spyOn(t,"find").and.returnValue({append:n});e.showConfirm(),expect(o).toHaveBeenCalledWith("body");var i=n.calls.mostRecent().args[0].scope();expect(i.title).toEqual(""),expect(i.message).toEqual(""),spyOn(e,"close"),i.okCallback(),expect(e.close).toHaveBeenCalled(),e.close.calls.reset(),i.cancelCallback(),expect(e.close).toHaveBeenCalled()}])),it("should allow setting of custom properties",inject(["$document",function(t){var n=jasmine.createSpy("append"),o=spyOn(t,"find").and.returnValue({append:n}),i=jasmine.createSpy("cancel"),r=jasmine.createSpy("ok");e.showConfirm({title:"my title",message:"my message",okCallback:r,cancelCallback:i}),expect(o).toHaveBeenCalledWith("body");var a=n.calls.mostRecent().args[0].scope();expect(a.title).toEqual("my title"),expect(a.message).toEqual("my message"),spyOn(e,"close"),a.okCallback(),expect(e.close).toHaveBeenCalled(),expect(r).toHaveBeenCalled(),e.close.calls.reset(),a.cancelCallback(),expect(e.close).toHaveBeenCalled(),expect(i).toHaveBeenCalled()}]))})}),angular.module("liveopsConfigPanel.shared.services").service("Chain",["$cacheFactory",function(e){e("chains");var t=function(e){this.name=e};return t.create=function(e,n){var o=t.get(e);return o.hook("init",n,0),o},t.get=function(n){var o=e.get("chains");return o.get(n)||o.put(n,{}),new t(n)},t.prototype.hook=function(t,n,o){var i=e.get("chains"),r=i.get(this.name);r[t]={id:t,callback:n,priority:o}},t.prototype.execute=function(t){var n,o=e.get("chains"),i=o.get(this.name);angular.forEach(i,function(e){if(n)if(angular.isFunction(e.callback))n.then(e.callback);else{if(!angular.isObject(e.callback))throw new Error('Invalid callback type "'+typeof e.callback+'"');n.then(e.callback.success,e.callback.failure)}else{if(!angular.isFunction(e.callback))throw new Error('Invalid callback type "'+typeof e.callback+'"');n=e.callback(t)}})},t}]),describe("Chain service",function(){var e,t;beforeEach(module("liveopsConfigPanel.shared.services")),beforeEach(module("liveopsConfigPanel.shared.services.mock.content")),beforeEach(inject(["Chain","$cacheFactory",function(n,o){e=n,t=o}])),describe("ON Chain.get",function(){it("should return an empty object on first get",function(){e.get("user:save");var n=t.get("chains").get("user:save");expect(n).toEqual(jasmine.any(Object))}),it("should cache the items I push to it",function(){e.get("user:save").hook("link1",function(){});var n=t.get("chains").get("user:save");
expect(n.hasOwnProperty("link1")).toBeTruthy()}),it("should not create a new chain once already got",function(){e.get("user:save").hook("link1",function(){}),e.get("user:save");var n=t.get("chains").get("user:save");expect(n.hasOwnProperty("link1")).toBeTruthy()})}),describe("ON Chain.prototype.hook",function(){it("should push callback onto the chain",function(){var n=e.get("chain1");n.hook("link1",null,100);var o=t.get("chains").get("chain1");expect(o.hasOwnProperty("link1")).toBeTruthy(),expect(o.link1.id).toEqual("link1"),expect(o.link1.priority).toEqual(100)}),it("should push multiple callback onto the chain",function(){var n=e.get("chain1");n.hook("link1",null,100),n.hook("link2",null,50);var o=t.get("chains").get("chain1");expect(o.hasOwnProperty("link1")).toBeTruthy(),expect(o.link1.id).toEqual("link1"),expect(o.link1.priority).toEqual(100),expect(o.hasOwnProperty("link2")).toBeTruthy(),expect(o.link2.id).toEqual("link2"),expect(o.link2.priority).toEqual(50)})}),describe("ON Chain.prototype.execute",function(){var t,n;beforeEach(inject(["$q","$timeout",function(e,o){t=e,n=o}])),it("should execute single callback",function(){var t=jasmine.createSpy("first callback"),n=e.get("chain1");n.hook("link1",t,100),n.execute(),expect(t).toHaveBeenCalled()}),it("should throw error if first callback is not a function",function(){var t=e.get("chain1");t.hook("link1",null,100);var n;try{t.execute()}catch(o){n=o}expect(n).toBeDefined()}),it("should throw error if any callback is not a function or object",function(){var n=e.get("chain1");n.hook("link1",function(){return t.when()},1),n.hook("link2",null,2);var o;try{n.execute()}catch(i){o=i}expect(o).toBeDefined()}),describe("WHEN first link is resolved",function(){var o;beforeEach(function(){o=function(){var e=t.defer();return n(function(){e.resolve()}),e.promise}}),it("should execute second link callback",function(){var t=jasmine.createSpy("second callback"),i=e.get("chain1");i.hook("link1",o,1),i.hook("link2",t,2),i.execute(),n.flush(),expect(t).toHaveBeenCalled()}),it("should execute second links success",function(){var t=jasmine.createSpy("success callback"),i=jasmine.createSpy("fail callback"),r=e.get("chain1");r.hook("link1",o,1),r.hook("link2",{success:t,fail:i},2),r.execute(),n.flush(),expect(t).toHaveBeenCalled(),expect(i).not.toHaveBeenCalled()})}),describe("WHEN first link is rejected",function(){var o;beforeEach(function(){o=function(){var e=t.defer();return n(function(){e.reject()}),e.promise}}),it("should not execute second callback if first callback is rejected",function(){var t=jasmine.createSpy("second callback"),i=e.get("chain1");i.hook("link1",o,1),i.hook("link2",t,2),i.execute(),n.flush(),expect(t).not.toHaveBeenCalled()}),it("should execute second links fail",function(){var t=jasmine.createSpy("success callback"),i=jasmine.createSpy("fail callback"),r=e.get("chain1");r.hook("link1",o,1),r.hook("link2",{success:t,failure:i},2),r.execute(),n.flush(),expect(t).not.toHaveBeenCalled(),expect(i).toHaveBeenCalled()})})})}),angular.module("liveopsConfigPanel.shared.directives").directive("editFieldDropDown",function(){return{restrict:"E",transclude:!0,templateUrl:"app/shared/directives/editField/dropDown/editField_DropDown.html",scope:{ngModel:"=",save:"=",objectId:"=",defaultText:"@",name:"@",label:"@",placeholder:"@"},controller:"EditFieldController"}}),describe("editField dropDownDirective",function(){var e,t,n="1c838030-f772-11e4-ac37-45b2e1245d4b",o="Ron";beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope",function(n,o){e=o.$new(),t=n}])),it("should emit event on saveHandler",inject(function(){e.objectId=n,e.value=o;var i=t('<edit-field-drop-down ng-model="value" name="name" object-id="objectId" default-text="Select role"></edit-field-drop-down>')(e);e.$digest();var r=i.isolateScope();spyOn(r,"$emit"),expect(r.saveHandler).toBeDefined(),r.saveHandler(),expect(r.$emit).toHaveBeenCalledWith("editField:save",{objectId:n,fieldName:"name",fieldValue:o})})),it("should set edit to true on successful broadcast",inject(function(){e.objectId=n,e.value=o;var i=t('<edit-field-drop-down ng-model="value" name="name" object-id="objectId" default-text="Select role"></edit-field-drop-down>')(e);e.$digest();var r=i.isolateScope(),a={foo:"bar"},l={statusCode:200};r.edit=!0,e.$broadcast("name:save",a,l),expect(r.edit).toEqual(!1)})),it("should not set edit to true on unsuccessful broadcast",inject(function(){e.objectId=n,e.value=o;var i=t('<edit-field-drop-down ng-model="value" name="name" object-id="objectId" default-text="Select role"></edit-field-drop-down>')(e);e.$digest();var r=i.isolateScope(),a={foo:"bar"},l={statusCode:404};r.edit=!0,e.$broadcast("name:save:error",a,l),expect(r.edit).toEqual(!0)}))}),angular.module("liveopsConfigPanel.shared.directives").directive("editField",function(){return{restrict:"E",templateUrl:"app/shared/directives/editField/input/editField_input.html",scope:{ngModel:"=",save:"=",objectId:"=",name:"@",label:"@",type:"@",placeholder:"@"},controller:"EditFieldController"}}),describe("editField",function(){var e,t,n="1c838030-f772-11e4-ac37-45b2e1245d4b",o="Ron";beforeEach(module("liveopsConfigPanel.shared.directives")),beforeEach(module("gulpAngular")),beforeEach(inject(["$compile","$rootScope",function(n,o){e=o.$new(),t=n}])),it("should emit event on saveHandler",inject(function(){e.objectId=n,e.value=o;var i=t('<edit-field ng-model="value" name="name" object-id="objectId" default-text="Select role"></edit-field>')(e);e.$digest();var r=i.isolateScope();spyOn(r,"$emit"),expect(r.saveHandler).toBeDefined(),r.saveHandler(),expect(r.$emit).toHaveBeenCalledWith("editField:save",{objectId:n,fieldName:"name",fieldValue:o})})),it("should set edit to true on successful broadcast",inject(function(){e.objectId=n,e.value=o;var i=t('<edit-field ng-model="value" name="name" object-id="objectId" default-text="Select role"></edit-field>')(e);e.$digest();var r=i.isolateScope(),a={foo:"bar"},l={statusCode:200};r.edit=!0,e.$broadcast("name:save",a,l),expect(r.edit).toEqual(!1)})),it("should not set edit to true on unsuccessful broadcast",inject(function(){e.objectId=n,e.value=o;var i=t('<edit-field ng-model="value" name="name" object-id="objectId" default-text="Select role"></edit-field>')(e);e.$digest();var r=i.isolateScope(),a={foo:"bar"},l={statusCode:404};r.edit=!0,e.$broadcast("name:save:error",a,l),expect(r.edit).toEqual(!0)}))});